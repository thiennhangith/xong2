<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ thống Xét tuyển ĐH 2025 - Tích hợp Gemini AI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, Helvetica, sans-serif;
            font-size: 13px;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.4;
        }

        /* Header chính thức */
        .header {
            background: linear-gradient(to bottom, #1e5799 0%, #2989d8 50%, #207cca 51%, #7db9e8 100%);
            color: white;
            padding: 6px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-bottom: 3px solid #1e5799;
        }

        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo {
            width: 48px;
            height: 48px;
            background: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #1e5799;
            font-size: 9px;
            border: 2px solid #fff;
            text-align: center;
            line-height: 1.0;
        }

        .site-title {
            font-size: 14px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            line-height: 1.2;
        }

        .site-subtitle {
            font-size: 10px;
            opacity: 0.9;
            margin-top: 1px;
        }

        .hotline {
            background: #d9534f;
            padding: 5px 10px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 10px;
            animation: pulse 2s infinite;
            box-shadow: 0 2px 5px rgba(217,85,79,0.3);
            white-space: nowrap;
            cursor: pointer;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Navigation */
        .nav-bar {
            background: #fff;
            border-bottom: 1px solid #ddd;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
            position: relative;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            background: #f8f9fa;
            border-radius: 4px;
            margin: 5px 0;
            overflow: hidden;
        }

        .nav-menu li {
            border-right: 1px solid #ddd;
        }

        .nav-menu li:last-child {
            border-right: none;
        }

        .nav-menu a {
            display: block;
            padding: 7px 12px;
            text-decoration: none;
            color: #337ab7;
            font-size: 10px;
            transition: all 0.3s;
            white-space: nowrap;
            cursor: pointer;
        }

        .nav-menu a:hover, .nav-menu a.active {
            background-color: #337ab7;
            color: white;
        }

        /* Nút HDSD - đã sửa to hơn và rõ hơn */
        .guide-btn {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: #5cb85c;
            color: white;
            border: none;
            border-radius: 8px;
            width: 65px;
            height: 45px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 3px 8px rgba(0,0,0,0.3);
            transition: all 0.3s;
        }

        .guide-btn:hover {
            background: #449d44;
            transform: translateY(-50%) scale(1.05);
        }

        /* Main Container */
        .main-container {
            max-width: 1200px;
            margin: 10px auto;
            padding: 0 15px;
            display: flex;
            gap: 15px;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 3px;
            height: fit-content;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .sidebar-header {
            background: #337ab7;
            color: white;
            padding: 8px 10px;
            font-weight: bold;
            border-radius: 3px 3px 0 0;
            font-size: 11px;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            border-bottom: 1px solid #f0f0f0;
        }

        .sidebar-menu a {
            display: block;
            padding: 8px 10px;
            text-decoration: none;
            color: #337ab7;
            font-size: 10px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: #f5f5f5;
            color: #23527c;
            border-left: 3px solid #337ab7;
            padding-left: 7px;
        }

        /* Content */
        .content {
            flex: 1;
            background: white;
            border: 1px solid #ddd;
            border-radius: 3px;
            padding: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .user-info {
            background: #d9edf7;
            border: 1px solid #bce8f1;
            padding: 7px 10px;
            border-radius: 3px;
            margin-bottom: 15px;
            font-weight: bold;
            color: #31708f;
            font-size: 11px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title {
            font-size: 13px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            text-align: center;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 3px;
            border-left: 4px solid #337ab7;
        }

        /* Form Styles */
        .form-section {
            margin-bottom: 18px;
            border: 1px solid #e0e0e0;
            border-radius: 3px;
            background: #fafafa;
        }

        .form-section h4 {
            background: #337ab7;
            color: white;
            padding: 7px 10px;
            margin: 0 0 10px 0;
            border-radius: 3px 3px 0 0;
            font-size: 11px;
        }

        .form-content {
            padding: 10px;
        }

        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: end;
        }

        .form-group {
            flex: 1;
        }

        .form-group.small {
            flex: 0 0 100px;
        }
        
        .form-group.action-buttons {
            flex: 0 0 auto;
        }

        .form-group label {
            font-weight: bold;
            margin-bottom: 3px;
            color: #333;
            font-size: 10px;
            display: block;
        }

        .form-control {
            width: 100%;
            padding: 5px 8px;
            border: 1px solid #ccc;
            border-radius: 3px;
            font-size: 11px;
            transition: all 0.3s;
        }

        .form-control:focus {
            border-color: #337ab7;
            outline: none;
            box-shadow: 0 0 5px rgba(51, 122, 183, 0.3);
        }

        .required {
            color: #d9534f;
        }

        /* Info cards với chỉnh sửa */
        .info-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 3px;
            padding: 8px;
            margin-bottom: 8px;
            font-size: 10px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 2px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: bold;
            color: #666;
        }

        .info-value {
            color: #333;
            flex: 1;
            margin: 0 10px;
        }

        .edit-btn {
            background: #5bc0de;
            color: white;
            border: none;
            border-radius: 2px;
            padding: 2px 6px;
            font-size: 9px;
            cursor: pointer;
        }

        .edit-btn:hover {
            background: #46b8da;
        }

        .edit-input {
            display: none;
            width: 100%;
            padding: 2px 4px;
            font-size: 10px;
            border: 1px solid #ccc;
            border-radius: 2px;
        }

        .edit-controls {
            display: none;
            gap: 3px;
        }

        .save-btn {
            background: #5cb85c;
            color: white;
            border: none;
            border-radius: 2px;
            padding: 2px 6px;
            font-size: 9px;
            cursor: pointer;
        }

        .cancel-btn {
            background: #d9534f;
            color: white;
            border: none;
            border-radius: 2px;
            padding: 2px 6px;
            font-size: 9px;
            cursor: pointer;
        }

        /* Wish container với drag & drop */
        .wish-header {
            background: #f8f9fa;
            padding: 8px;
            border: 1px solid #e0e0e0;
            border-radius: 3px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .wish-stats {
            font-size: 10px;
            color: #666;
        }

        .wish-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 3px;
            background: white;
            position: relative;
        }

        .wish-item {
            background: #f9f9f9;
            border-bottom: 1px solid #e0e0e0;
            padding: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            font-size: 10px;
            position: relative;
            cursor: default;
        }

        .wish-item:hover {
            background-color: #e6f3ff;
        }

        .wish-item:last-child {
            border-bottom: none;
        }

        .wish-item.dragging {
            opacity: 0.8;
            background-color: #fff3cd;
            transform: rotate(2deg);
            z-index: 1000;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .wish-item.drag-over {
            border-top: 3px solid #337ab7;
            background-color: #e6f3ff;
        }

        .drag-handle {
            background: #6c757d;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: grab;
            font-size: 12px;
            flex-shrink: 0;
            user-select: none;
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        .wish-number {
            background: #337ab7;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 10px;
            flex-shrink: 0;
        }

        .wish-content {
            flex: 1;
        }

        .wish-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 2px;
        }

        .wish-details {
            color: #666;
            font-size: 9px;
        }

        .remove-wish {
            background: #d9534f;
            color: white;
            border: none;
            border-radius: 3px;
            padding: 3px 6px;
            font-size: 9px;
            cursor: pointer;
            flex-shrink: 0;
        }

        .remove-wish:hover {
            background: #c9302c;
        }

        /* Payment section */
        .payment-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 3px;
            padding: 10px;
            margin: 10px 0;
        }

        .payment-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 11px;
        }

        .payment-total {
            font-weight: bold;
            color: #d9534f;
            font-size: 13px;
        }

        /* Buttons */
        .btn {
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
            font-weight: bold;
            text-decoration: none;
            display: inline-block;
            margin: 2px;
            transition: all 0.3s;
        }

        .btn-primary {
            background-color: #337ab7;
            color: white;
            border: 1px solid #2e6da4;
        }

        .btn-primary:hover {
            background-color: #286090;
            transform: translateY(-1px);
        }

        .btn-success {
            background-color: #5cb85c;
            color: white;
            border: 1px solid #4cae4c;
        }

        .btn-warning {
            background-color: #f0ad4e;
            color: white;
        }

        .btn-info {
            background-color: #5bc0de;
            color: white;
        }

        .btn-sm {
            padding: 3px 6px;
            font-size: 10px;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            background-color: #a0a0a0;
        }
        
        /* Bổ sung style cho loading container */
        #processLoadingContainer {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Alert */
        .alert {
            padding: 8px 10px;
            margin-bottom: 12px;
            border: 1px solid transparent;
            border-radius: 3px;
            font-size: 11px;
        }

        .alert-info {
            color: #31708f;
            background-color: #d9edf7;
            border-color: #bce8f1;
        }

        .alert-warning {
            color: #8a6d3b;
            background-color: #fcf8e3;
            border-color: #faebcc;
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        .loading-gemini {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
            flex-direction: column;
            gap: 10px;
            color: #666;
        }
        .loading-gemini .spinner {
             width: 40px;
             height: 40px;
             border: 4px solid #f3f3f3;
             border-top: 4px solid #337ab7;
             border-radius: 50%;
             animation: spin 1s linear infinite;
        }


        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 0;
            border-radius: 5px;
            width: 95%;
            max-width: 1000px;
            max-height: 95vh;
            overflow: hidden;
            animation: modalSlide 0.3s ease;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .modal-header {
            background: #337ab7;
            color: white;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 13px;
            font-weight: bold;
        }

        .modal-body {
            padding: 15px;
            max-height: 75vh;
            overflow-y: auto;
        }

        .modal-footer {
            padding: 10px 15px;
            background: #f8f9fa;
            text-align: center;
            border-top: 1px solid #e0e0e0;
        }

        @keyframes modalSlide {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close {
            color: white;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            opacity: 0.8;
        }

        .close:hover {
            opacity: 1;
        }

        /* Results */
        .result-success {
            background: #dff0d8;
            border: 1px solid #d6e9c6;
            color: #3c763d;
            padding: 10px;
            border-radius: 3px;
            margin: 10px 0;
            text-align: center;
        }

        .result-fail {
            background: #f2dede;
            border: 1px solid #ebccd1;
            color: #a94442;
            padding: 10px;
            border-radius: 3px;
            margin: 10px 0;
            text-align: center;
        }

        .celebration {
            font-size: 36px;
            text-align: center;
            margin: 10px 0;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 20%, 60%, 100% { transform: translateY(0); }
            40% { transform: translateY(-5px); }
            80% { transform: translateY(-2px); }
        }

        /* Data table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 10px;
            margin: 8px 0;
        }

        .data-table th,
        .data-table td {
            border: 1px solid #ddd;
            padding: 5px;
            text-align: left;
            vertical-align: top;
        }

        .data-table th {
            background-color: #337ab7;
            color: white;
            font-weight: bold;
            text-align: center;
        }

        .data-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .data-table tr:hover {
            background-color: #e6f3ff;
        }

        /* Certificate */
        .admission-certificate {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #337ab7;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .admission-certificate::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #ffeaa7);
            border-radius: 8px 8px 0 0;
        }

        .university-logo {
            width: 60px;
            height: 60px;
            background: #337ab7;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            color: white;
            font-weight: bold;
            font-size: 12px;
        }

        /* Toast notification */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ff6b6b;
            color: white;
            padding: 15px 20px;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 9999;
            animation: toastSlide 0.3s ease;
            font-size: 14px;
            max-width: 300px;
        }

        @keyframes toastSlide {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .toast.fade-out {
            animation: toastFade 0.3s ease forwards;
        }

        @keyframes toastFade {
            from { opacity: 1; transform: translateX(0); }
            to { opacity: 0; transform: translateX(100%); }
        }

        /* Footer */
        .footer {
            background: #333;
            color: white;
            text-align: center;
            padding: 8px 0;
            margin-top: 20px;
            font-size: 10px;
        }

        /* Responsive - TỐI ƯU CHO DI ĐỘNG */
        @media (max-width: 768px) {
            body {
                font-size: 14px; /* Tăng font chữ gốc cho dễ đọc */
            }
            .main-container {
                flex-direction: column;
                gap: 10px;
                padding: 0 5px;
                margin-top: 5px;
            }
            
            .sidebar {
                width: 100%;
            }
            
            .nav-menu {
                flex-wrap: wrap;
                justify-content: center;
            }
            .nav-menu li {
                flex-grow: 1;
                text-align: center;
            }
            .nav-menu a {
                font-size: 11px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 8px;
            }

            .header-container {
                flex-direction: column;
                gap: 8px;
                padding: 10px 15px;
                text-align: center;
            }
            .site-title {
                font-size: 13px;
            }
            .hotline {
                font-size: 11px;
            }
            .nav-container {
                padding: 0 10px;
            }
            .guide-btn {
                position: relative;
                transform: none;
                top: auto;
                right: auto;
                display: block;
                width: 100%;
                margin: 10px 0 5px 0;
                height: 40px;
            }
            .user-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            .wish-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            .wish-content {
                width: 100%;
            }
            .remove-wish {
                align-self: flex-end;
            }
            .modal-content {
                width: 100%;
                margin: 0;
                height: 100%;
                max-height: 100vh;
                border-radius: 0;
            }
            .modal-body {
                max-height: calc(100vh - 110px); /* Adjust for header/footer */
            }
            .content {
                padding: 10px;
            }

            /* Responsive Tables - Chuyển bảng thành dạng card */
            .data-table {
                border: none;
            }
            .data-table thead {
                display: none; /* Ẩn tiêu đề bảng */
            }
            .data-table tr {
                display: block;
                margin-bottom: 15px;
                border: 1px solid #ddd;
                border-radius: 4px;
                box-shadow: 0 1px 3px rgba(0,0,0,0.1);
                background: white;
                padding: 5px;
            }
            .data-table td {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 10px;
                text-align: right; /* Căn phải nội dung */
                border-bottom: 1px solid #f0f0f0;
                font-size: 12px;
            }
            .data-table td:last-child {
                border-bottom: none;
            }
            .data-table td::before {
                content: attr(data-label); /* Lấy nội dung từ attribute data-label */
                font-weight: bold;
                text-align: left; /* Căn trái nhãn */
                margin-right: 10px;
                color: #337ab7;
                flex-shrink: 0;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-container">
            <div class="logo-section">
                <div class="logo">BGD<br>&ĐT</div>
                <div>
                    <div class="site-title">HỆ THỐNG QUẢN LÝ THI TỐT NGHIỆP THPT</div>
                    <div class="site-subtitle">Bộ Giáo dục và Đào tạo</div>
                </div>
            </div>
            <div class="hotline" onclick="showDecorativeAlert()">📞 HOTLINE: 1800 8000 - 2</div>
        </div>
    </div>

    <div class="nav-bar">
        <div class="nav-container">
            <ul class="nav-menu">
                <li><a href="javascript:void(0)" onclick="showDecorativeAlert()" class="active">🏠 Trang chủ</a></li>
                <li><a href="javascript:void(0)" onclick="showDecorativeAlert()">📝 Phiếu đăng ký</a></li>
                <li><a href="javascript:void(0)" onclick="showDecorativeAlert()">🔍 Tra cứu điểm</a></li>
                <li><a href="javascript:void(0)" onclick="showDecorativeAlert()">🎯 Đăng ký nguyện vọng</a></li>
                <li><a href="javascript:void(0)" onclick="showDecorativeAlert()">📊 Tra cứu kết quả</a></li>
                <li><a href="javascript:void(0)" onclick="showDecorativeAlert()">🔑 Đổi mã đăng nhập</a></li>
            </ul>
            <button class="guide-btn" onclick="showGuide()" title="Hướng dẫn sử dụng">HDSD</button>
        </div>
    </div>

    <div class="main-container">
        <div class="sidebar">
            <div class="sidebar-header">MENU CHỨC NĂNG</div>
            <ul class="sidebar-menu">
                <li><a href="javascript:void(0)" onclick="showDecorativeAlert()" class="active">🏠 Trang chủ</a></li>
                <li><a href="javascript:void(0)" onclick="showDecorativeAlert()">📝 Phiếu đăng ký</a></li>
                <li><a href="javascript:void(0)" onclick="showDecorativeAlert()">📋 Phiếu đăng ký chi tiết</a></li>
                <li><a href="javascript:void(0)" onclick="showDecorativeAlert()">✏️ Sửa email và số điện thoại</a></li>
                <li><a href="javascript:void(0)" onclick="showDecorativeAlert()">🔍 Tra cứu</a></li>
                <li><a href="javascript:void(0)" onclick="showDecorativeAlert()">📄 Tra cứu giấy báo dự thi</a></li>
                <li><a href="javascript:void(0)" onclick="showDecorativeAlert()">📊 Tra cứu điểm</a></li>
                <li><a href="javascript:void(0)" onclick="showDecorativeAlert()">🔢 Tra cứu mã xét tuyển theo đợt</a></li>
                <li><a href="javascript:void(0)" onclick="showDecorativeAlert()">📚 Học bạ THPT</a></li>
                <li><a href="javascript:void(0)" onclick="showDecorativeAlert()">🧠 Tra cứu điểm thi ĐGNL/Tư duy</a></li>
                <li><a href="javascript:void(0)" onclick="showDecorativeAlert()">🏆 Tra cứu thông tin tuyển thẳng</a></li>
                <li><a href="javascript:void(0)" onclick="showDecorativeAlert()">✅ Tra cứu kết quả sơ tuyển</a></li>
                <li><a href="javascript:void(0)" onclick="showDecorativeAlert()">🌐 Danh sách chứng chỉ ngoại ngữ</a></li>
                <li><a href="javascript:void(0)" onclick="showDecorativeAlert()">🎯 Đăng ký thông tin xét tuyển sinh</a></li>
                <li><a href="javascript:void(0)" onclick="showDecorativeAlert()">🔑 Đổi mã đăng nhập</a></li>
            </ul>
        </div>

        <div class="content">
            <div class="user-info">
                <div style="display: flex; align-items: center; flex: 1;">
                    <span>👤 <strong id="userName">NGUYỄN VĂN A</strong></span>
                    <input type="text" id="editNameInput" class="form-control" style="display: none; margin-left: 10px; width: 200px;">
                    <div id="editNameButtons" style="display: none; margin-left: 10px; gap: 5px;">
                        <button class="btn btn-success btn-sm" onclick="saveNewName()">✅</button>
                        <button class="btn btn-warning btn-sm" onclick="cancelEditName()">❌</button>
                    </div>
                </div>
                <div>
                    <button class="btn btn-info btn-sm" id="editNameBtn" onclick="editName()">✏️ Sửa tên</button>
                    <span style="margin-left: 10px; font-size: 10px;">- Chào mừng bạn đến với hệ thống xét tuyển 2025</span>
                </div>
            </div>

            <div class="page-title">🎓 HỆ THỐNG XÉT TUYỂN ĐẠI HỌC 2025 (Tích hợp Gemini AI)</div>

            <div class="alert alert-info">
                <strong>📢 PHIÊN BẢN NÂNG CẤP VỚI GEMINI AI:</strong><br>
                • <strong>✨ MỚI:</strong> Nhận tư vấn chiến lược sắp xếp nguyện vọng từ AI.<br>
                • <strong>✨ MỚI:</strong> Tra cứu thông tin chi tiết về ngành học bất kỳ.<br>
                • Giữ nguyên 4 trường đại học, dữ liệu điểm chuẩn 2024 và tất cả tính năng cốt lõi.
            </div>

            <div class="form-section">
                <h4>📋 I. THÔNG TIN CÁ NHÂN (Có thể chỉnh sửa)</h4>
                <div class="form-content">
                    <div class="info-card">
                        <div class="info-row">
                            <span class="info-label">Họ và tên:</span>
                            <span class="info-value" id="userNameInfo">NGUYỄN VĂN A</span>
                            <input type="text" class="edit-input" id="editUserName" value="NGUYỄN VĂN A">
                            <div class="edit-controls">
                                <button class="save-btn" onclick="saveInfo('userNameInfo', 'editUserName')">✓</button>
                                <button class="cancel-btn" onclick="cancelEdit('userNameInfo', 'editUserName')">✕</button>
                            </div>
                            <button class="edit-btn" onclick="editInfo('userNameInfo', 'editUserName')">✏️</button>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Số hồ sơ:</span>
                            <span class="info-value" id="studentId">123456</span>
                            <input type="text" class="edit-input" id="editStudentId" value="123456">
                            <div class="edit-controls">
                                <button class="save-btn" onclick="saveInfo('studentId', 'editStudentId')">✓</button>
                                <button class="cancel-btn" onclick="cancelEdit('studentId', 'editStudentId')">✕</button>
                            </div>
                            <button class="edit-btn" onclick="editInfo('studentId', 'editStudentId')">✏️</button>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Nơi sinh:</span>
                            <span class="info-value" id="birthPlace">Hà Nội</span>
                            <input type="text" class="edit-input" id="editBirthPlace" value="Hà Nội">
                            <div class="edit-controls">
                                <button class="save-btn" onclick="saveInfo('birthPlace', 'editBirthPlace')">✓</button>
                                <button class="cancel-btn" onclick="cancelEdit('birthPlace', 'editBirthPlace')">✕</button>
                            </div>
                            <button class="edit-btn" onclick="editInfo('birthPlace', 'editBirthPlace')">✏️</button>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Trường THPT:</span>
                            <span class="info-value" id="highSchool">THPT Hogwarts</span>
                            <input type="text" class="edit-input" id="editHighSchool" value="THPT Hogwarts">
                            <div class="edit-controls">
                                <button class="save-btn" onclick="saveInfo('highSchool', 'editHighSchool')">✓</button>
                                <button class="cancel-btn" onclick="cancelEdit('highSchool', 'editHighSchool')">✕</button>
                            </div>
                            <button class="edit-btn" onclick="editInfo('highSchool', 'editHighSchool')">✏️</button>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Khu vực:</span>
                            <span class="info-value">
                                <select id="areaSelect" class="form-control" style="width: auto; font-size: 10px;" onchange="updateAreaInfo()">
                                    <option value="KV1">KV1 - Xã miền núi, vùng đặc biệt khó khăn (+0.75 điểm)</option>
                                    <option value="KV2NT" selected>KV2-NT - Khu vực 2 nông thôn (+0.5 điểm)</option>
                                    <option value="KV2">KV2 - Thị xã, thành phố trực thuộc tỉnh (+0.25 điểm)</option>
                                    <option value="KV3">KV3 - Quận nội thành thành phố TT TW (0 điểm)</option>
                                </select>
                            </span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Điểm ưu tiên hiện tại:</span>
                            <span class="info-value" id="currentBonusInfo">+0.5 điểm (giảm dần nếu tổng điểm ≥22.5)</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h4>📊 THAM KHẢO ĐIỂM CHUẨN NĂM 2024</h4>
                <div class="form-content">
                    <div style="text-align: center; margin-bottom: 10px;">
                        <button type="button" class="btn btn-info btn-sm" onclick="showCutoff2024('UIT')">
                            📈 UIT 2024
                        </button>
                        <button type="button" class="btn btn-info btn-sm" onclick="showCutoff2024('HCMUS')">
                            📈 HCMUS 2024
                        </button>
                        <button type="button" class="btn btn-info btn-sm" onclick="showCutoff2024('SPKT')">
                            📈 SPKT 2024
                        </button>
                        <button type="button" class="btn btn-info btn-sm" onclick="showCutoff2024('FPT')">
                            📈 FPT 2024
                        </button>
                    </div>
                    <p style="font-size: 10px; text-align: center; color: #666;">
                        💡 Tham khảo để có chiến lược đăng ký nguyện vọng hợp lý
                    </p>
                </div>
            </div>

            <div class="form-section">
                <h4>📊 II. ĐIỂM THI TỐT NGHIỆP THPT 2025</h4>
                <div class="form-content">
                    <div class="alert alert-warning" style="margin-bottom: 10px;">
                        <strong>⚠️ Lưu ý:</strong> Chỉ hỗ trợ điểm thi THPT Quốc gia. Điểm nhập là điểm gốc (thang 10).
                    </div>
                    
                    <form id="scoreForm" oninput="checkGeminiButtons()">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="toan">📐 Toán (bắt buộc) <span class="required">*</span>:</label>
                                <input type="number" id="toan" class="form-control" min="0" max="10" step="0.01" placeholder="0.00" required>
                            </div>
                            <div class="form-group">
                                <label for="van">📖 Ngữ văn (bắt buộc) <span class="required">*</span>:</label>
                                <input type="number" id="van" class="form-control" min="0" max="10" step="0.01" placeholder="0.00" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="subject1">🎯 Môn tự chọn 1 <span class="required">*</span>:</label>
                                <select id="subject1" class="form-control" required onchange="updateSubjectInputs()">
                                    <option value="">-- Chọn môn --</option>
                                    <option value="anh">Tiếng Anh</option>
                                    <option value="ly">Vật lý</option>
                                    <option value="hoa">Hóa học</option>
                                    <option value="sinh">Sinh học</option>
                                    <option value="su">Lịch sử</option>
                                    <option value="dia">Địa lý</option>
                                    <option value="gdkt">GDKT & PL</option>
                                    <option value="tin">Tin học</option>
                                    <option value="congnghe">Công nghệ</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="score1">Điểm môn 1 <span class="required">*</span>:</label>
                                <input type="number" id="score1" class="form-control" min="0" max="10" step="0.01" placeholder="0.00" required disabled>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="subject2">🎯 Môn tự chọn 2 <span class="required">*</span>:</label>
                                <select id="subject2" class="form-control" required onchange="updateSubjectInputs()">
                                    <option value="">-- Chọn môn --</option>
                                    <option value="anh">Tiếng Anh</option>
                                    <option value="ly">Vật lý</option>
                                    <option value="hoa">Hóa học</option>
                                    <option value="sinh">Sinh học</option>
                                    <option value="su">Lịch sử</option>
                                    <option value="dia">Địa lý</option>
                                    <option value="gdkt">GDKT & PL</option>
                                    <option value="tin">Tin học</option>
                                    <option value="congnghe">Công nghệ</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="score2">Điểm môn 2 <span class="required">*</span>:</label>
                                <input type="number" id="score2" class="form-control" min="0" max="10" step="0.01" placeholder="0.00" required disabled>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <div class="form-section">
                <h4>🎯 III. ĐĂNG KÝ NGUYỆN VỌNG (4 TRƯỜNG ĐẠI HỌC)</h4>
                <div class="form-content">
                    <div class="wish-header">
                        <div>
                            <strong>📋 Danh sách nguyện vọng (Kéo thả để đổi vị trí)</strong>
                        </div>
                        <div class="wish-stats">
                            <span>Tổng: <strong id="totalWishes">0</strong></span>
                        </div>
                    </div>

                    <div style="margin-bottom: 8px;">
                        <div class="form-row">
                            <div class="form-group">
                                <select id="schoolSelect" class="form-control" onchange="updateMajorSelect()">
                                    <option value="">-- Chọn trường trước --</option>
                                    <option value="UIT">🏫 Đại học Công nghệ Thông tin (UIT)</option>
                                    <option value="HCMUS">🏫 Đại học Khoa học Tự nhiên (HCMUS)</option>
                                    <option value="SPKT">🏫 Đại học Sư phạm Kỹ thuật TPHCM (SPKT)</option>
                                    <option value="FPT">🏫 Đại học FPT TPHCM (FPT)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <select id="majorSelect" class="form-control" disabled onchange="checkGeminiButtons()">
                                    <option value="">-- Chọn ngành --</option>
                                </select>
                            </div>
                            <div class="form-group action-buttons" style="display: flex; gap: 5px;">
                                <button type="button" class="btn btn-success btn-sm" onclick="addWish()">➕ Thêm</button>
                                <button type="button" class="btn btn-info btn-sm" id="geminiMajorInfoBtn" onclick="getMajorInfo()" disabled>✨ Tìm hiểu ngành</button>
                                <button type="button" class="btn btn-warning btn-sm" onclick="clearAllWishes()">🗑️ Xóa tất cả</button>
                            </div>
                        </div>
                    </div>

                    <div class="wish-container" id="wishContainer">
                        <div style="text-align: center; color: #666; padding: 15px;">
                            <p>🎯 <strong>Chưa có nguyện vọng nào</strong></p>
                            <p style="font-size: 9px;">Chọn trường và ngành, nhấn "Thêm" để bắt đầu!</p>
                        </div>
                    </div>

                    <div class="payment-section" id="paymentSection" style="display: none;">
                        <h5 style="margin-bottom: 8px; color: #8a6d3b;">💳 THANH TOÁN NGUYỆN VỌNG (GIẢ LẬP)</h5>
                        <div class="payment-info">
                            <span>Số nguyện vọng: <strong id="paymentWishCount">0</strong></span>
                            <span>Đơn giá: <strong>15,000 VNĐ (giả)</strong></span>
                            <span class="payment-total">Tổng: <span id="paymentTotal">0 VNĐ</span></span>
                        </div>
                        <div style="text-align: center;">
                            <button type="button" class="btn btn-warning btn-sm" onclick="processPayment()">
                                💰 THANH TOÁN GIẢ LẬP
                            </button>
                        </div>
                    </div>

                    <div style="margin-top: 10px; text-align: center;">
                        <button type="button" class="btn btn-primary" id="submitBtn" onclick="processAdmissionComplete()" disabled>
                             <span id="submitBtnText">🚀 XÉT TUYỂN 2025</span>
                             <span id="processLoadingContainer" style="display: none;">
                                 <span class="loading"></span>
                                 <span>Đang xử lý hồ sơ...</span>
                             </span>
                        </button>
                        <button type="button" class="btn btn-success" id="geminiStrategyBtn" onclick="getStrategicAdvice()" disabled>✨ Tư vấn chiến lược NV</button>
                        <button type="button" class="btn btn-info btn-sm" onclick="fillSampleData()">📝 Dữ liệu mẫu</button>
                        <button type="button" class="btn btn-warning btn-sm" onclick="resetAll()">🔄 Reset</button>
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <h4>✨ Trợ lý AI Sắp xếp Nguyện vọng</h4>
                <div class="form-content">
                     <p style="font-size: 10px; color: #666; margin-bottom: 10px;">
                        Chưa biết nên sắp xếp nguyện vọng ra sao? Hãy chọn 2 ngành bạn mơ ước nhất, AI sẽ tự động tạo một danh sách nguyện vọng tối ưu dựa trên điểm số của bạn!
                    </p>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="aiWish1"><strong>Nguyện vọng 1 (Mơ ước nhất):</strong></label>
                            <select id="aiWish1" class="form-control"></select>
                        </div>
                         <div class="form-group">
                            <label for="aiWish2"><strong>Nguyện vọng 2 (Mơ ước thứ hai):</strong></label>
                            <select id="aiWish2" class="form-control"></select>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 10px;">
                        <button type="button" class="btn btn-primary" id="aiArrangeBtn" onclick="getAiArrangement()">Để AI Sắp xếp giúp bạn</button>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div id="guideModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">📚 HƯỚNG DẪN SỬ DỤNG HỆ THỐNG</div>
                <span class="close" onclick="closeGuideModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div style="background: #d9edf7; border: 1px solid #bce8f1; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
                    <h4 style="color: #31708f; margin-bottom: 8px;">👋 CHÀO MỪNG BẠN ĐẾN VỚI HỆ THỐNG MÔ PHỎNG XÉT TUYỂN 2025!</h4>
                    <p style="font-size: 11px; color: #31708f;">
                        Công cụ này được tạo ra để giúp bạn <strong>trải nghiệm thử</strong> quy trình xét tuyển Đại học, từ việc nhập điểm, đăng ký nguyện vọng cho đến xem kết quả.
                        <br><strong>Lưu ý quan trọng:</strong> Đây là hệ thống <strong>MÔ PHỎNG</strong>, không phải website chính thức của Bộ GD&ĐT. Mọi kết quả chỉ mang tính chất tham khảo và giải trí.
                    </p>
                </div>

                <h5 style="color: #337ab7; margin: 15px 0 8px 0;">📋 CÁC BƯỚC THỰC HIỆN (4 BƯỚC ĐƠN GIẢN)</h5>
                <ol style="font-size: 11px; margin-left: 20px; line-height: 1.6;">
                    <li><strong>Bước 1: Nhập thông tin & Điểm thi</strong>
                        <br>Điền điểm thi Tốt nghiệp THPT của bạn vào các ô tương ứng. Hệ thống chỉ yêu cầu 4 môn: Toán, Văn (bắt buộc) và 2 môn tự chọn. Bạn cũng có thể chỉnh sửa thông tin cá nhân và khu vực ưu tiên.
                    </li>
                    <li><strong>Bước 2: Thêm & Sắp xếp Nguyện vọng</strong>
                        <br>Chọn trường và ngành bạn yêu thích, sau đó nhấn "Thêm". Bạn có thể thêm nhiều nguyện vọng. Dùng chuột <strong>kéo và thả</strong> các nguyện vọng để sắp xếp lại thứ tự ưu tiên.
                    </li>
                    <li><strong>Bước 3: Thanh toán (Giả lập)</strong>
                        <br>Sau khi thêm nguyện vọng, bạn cần thực hiện thanh toán giả lập với chi phí 15.000đ/nguyện vọng. Đây chỉ là mô phỏng, <strong>bạn không mất tiền thật</strong>.
                    </li>
                    <li><strong>Bước 4: Xét tuyển & Xem kết quả</strong>
                        <br>Khi đã sẵn sàng, nhấn nút "XÉT TUYỂN 2025". Hệ thống sẽ xử lý và trả về kết quả chi tiết, cho bạn biết bạn đã trúng tuyển nguyện vọng nào.
                    </li>
                </ol>

                <h5 style="color: #337ab7; margin: 15px 0 8px 0;">✨ TÍNH NĂNG MỚI VỚI GEMINI AI</h5>
                <ul style="font-size: 11px; margin-left: 20px; line-height: 1.6;">
                    <li><strong>Tư vấn chiến lược NV:</strong> Sau khi nhập điểm và thêm NV, nhấn nút "✨ Tư vấn chiến lược NV", AI sẽ phân tích và cho bạn lời khuyên để tối ưu hóa cơ hội.</li>
                    <li><strong>Tìm hiểu ngành:</strong> Chọn một ngành học bất kỳ và nhấn nút "✨ Tìm hiểu ngành" để xem thông tin chi tiết về ngành đó do AI tổng hợp.</li>
                </ul>

                <h5 style="color: #337ab7; margin: 15px 0 8px 0;">💡 MẸO & PHÍM TẮT</h5>
                 <ul style="font-size: 11px; margin-left: 20px; line-height: 1.6;">
                    <li><strong>Dữ liệu mẫu:</strong> Nhấn nút "Dữ liệu mẫu" để điền nhanh điểm số và nguyện vọng ví dụ.</li>
                    <li><strong>Phím tắt:</strong>
                        <ul>
                            <li><strong>F1:</strong> Mở hướng dẫn này.</li>
                            <li><strong>F2:</strong> Sửa nhanh tên thí sinh.</li>
                            <li><strong>Ctrl + Enter:</strong> Thực hiện xét tuyển (khi nút đã sáng).</li>
                            <li><strong>Esc:</strong> Đóng tất cả các cửa sổ pop-up.</li>
                        </ul>
                    </li>
                </ul>

                <div style="background: #d4edda; border: 1px solid #c3e6cb; padding: 10px; border-radius: 5px; margin-top: 15px;">
                    <p style="font-size: 11px; color: #155724; text-align: center;">
                        Chúc các bạn thí sinh có những trải nghiệm thú vị và may mắn trong kỳ thi thật!<br>
                        <small>-NTTN-</small>
                    </p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success btn-sm" onclick="closeGuideModal()">✅ Đã hiểu</button>
            </div>
        </div>
    </div>

    <div id="cutoff2024Modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="cutoffModalTitle">📊 BẢNG ĐIỂM CHUẨN NĂM 2024</div>
                <span class="close" onclick="closeCutoff2024Modal()">&times;</span>
            </div>
            <div class="modal-body">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>Mã ngành</th>
                            <th>Tên ngành</th>
                            <th>Tổ hợp xét tuyển</th>
                            <th>Điều kiện Toán</th>
                            <th>Điểm chuẩn 2024</th>
                        </tr>
                    </thead>
                    <tbody id="cutoff2024TableBody">
                        </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button class="btn btn-info btn-sm" onclick="closeCutoff2024Modal()">✅ Đóng</button>
            </div>
        </div>
    </div>

    <div id="resultModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">🎓 KẾT QUẢ XÉT TUYỂN 2025</div>
                <span class="close" onclick="closeModal('resultModal')">&times;</span>
            </div>
            <div class="modal-body" id="modalBody">
                </div>
            <div class="modal-footer">
                <button class="btn btn-success btn-sm" onclick="closeModal('resultModal')">✅ Đóng</button>
                <button class="btn btn-info btn-sm" id="viewCutoff2025Btn" style="display: none;" onclick="showCutoff2025()">📊 Xem điểm chuẩn 2025</button>
                <button class="btn btn-warning btn-sm" id="viewRandomRatesBtn" style="display: none;" onclick="showRandomRates()">🎲 Tỷ lệ random của chúng tôi</button>
            </div>
        </div>
    </div>

    <div id="randomRatesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">🎲 TỶ LỆ RANDOM ĐIỂM CHUẨN 2025</div>
                <span class="close" onclick="closeModal('randomRatesModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 15px;">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Chọn trường:</label>
                            <select id="randomSchoolSelect" class="form-control" onchange="updateRandomMajorSelect()">
                                <option value="">-- Chọn trường --</option>
                                <option value="UIT">🏫 Đại học Công nghệ Thông tin (UIT)</option>
                                <option value="HCMUS">🏫 Đại học Khoa học Tự nhiên (HCMUS)</option>
                                <option value="SPKT">🏫 Đại học Sư phạm Kỹ thuật TPHCM (SPKT)</option>
                                <option value="FPT">🏫 Đại học FPT TPHCM (FPT)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <select id="randomMajorSelect" class="form-control" disabled>
                                <option value="">-- Chọn ngành --</option>
                            </select>
                        </div>
                        <div class="form-group small">
                            <button type="button" class="btn btn-primary btn-sm" onclick="showMajorRandomRate()">📊 Xem tỷ lệ</button>
                        </div>
                    </div>
                </div>
                <div id="randomRateDisplay">
                    <p style="text-align: center; color: #666; font-style: italic;">
                        🎯 Chọn trường và ngành để xem tỷ lệ random điểm chuẩn<br>
                        <small>(FPT không có random - giữ nguyên điểm chuẩn 2024)</small>
                    </p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success btn-sm" onclick="closeModal('randomRatesModal')">✅ Đóng</button>
            </div>
        </div>
    </div>

    <div id="cutoff2025Modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">📊 BẢNG ĐIỂM CHUẨN NĂM 2025</div>
                <span class="close" onclick="closeModal('cutoff2025Modal')">&times;</span>
            </div>
            <div class="modal-body">
                <div style="background: #d4edda; border: 1px solid #c3e6cb; border-radius: 5px; margin: 10px 0;">
                    <div style="background: #337ab7; color: white; padding: 10px; border-radius: 5px 5px 0 0; font-weight: bold; text-align: center;">
                        🎲 ĐIỂM CHUẨN NĂM 2025 - KẾT QUẢ RANDOM
                    </div>
                    <div style="padding: 15px;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>STT</th>
                                    <th>Trường</th>
                                    <th>Mã ngành</th>
                                    <th>Tên ngành</th>
                                    <th>DC 2024</th>
                                    <th>DC 2025</th>
                                    <th>So sánh</th>
                                </tr>
                            </thead>
                            <tbody id="cutoff2025TableBody">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success btn-sm" onclick="closeModal('cutoff2025Modal')">✅ Đóng</button>
            </div>
        </div>
    </div>
    
    <div id="geminiModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="geminiModalTitle">✨ Trợ lý AI Gemini</div>
                <span class="close" onclick="closeModal('geminiModal')">&times;</span>
            </div>
            <div class="modal-body" id="geminiModalBody">
                </div>
            <div class="modal-footer">
                <button class="btn btn-success btn-sm" onclick="closeModal('geminiModal')">✅ Đã hiểu</button>
            </div>
        </div>
    </div>


    <div class="footer">
        Hệ thống xét tuyển | Không phải website chính thức của Bộ GD&ĐT
    </div>

    <script>
        // DỮ LIỆU UIT - GIỮ NGUYÊN
        const uitMajors = [
            {
                school: 'UIT',
                code: '7480107', 
                name: 'Trí tuệ nhân tạo', 
                cutoff2024: 28.3, 
                subjects: ['A00', 'A01', 'D07'], 
                minMath: 6.0,
                probabilities: {decrease_over_025: 0, decrease_0_025: 0, increase_0_025: 0, increase_025_05: 5, increase_05_075: 15, increase_075_1: 30, increase_over_1: 50}
            },
            {
                school: 'UIT',
                code: '7460108', 
                name: 'Khoa học Dữ liệu', 
                cutoff2024: 27.5, 
                subjects: ['A00', 'A01', 'D07'], 
                minMath: 7.0,
                probabilities: {decrease_over_025: 0, decrease_0_025: 0, increase_0_025: 5, increase_025_05: 15, increase_05_075: 30, increase_075_1: 40, increase_over_1: 10}
            },
            {
                school: 'UIT',
                code: '7480101', 
                name: 'Khoa học máy tính', 
                cutoff2024: 27.3, 
                subjects: ['A00', 'A01', 'D07'], 
                minMath: 6.5,
                probabilities: {decrease_over_025: 0, decrease_0_025: 0, increase_0_025: 5, increase_025_05: 15, increase_05_075: 35, increase_075_1: 35, increase_over_1: 10}
            },
            {
                school: 'UIT',
                code: '7480202', 
                name: 'An toàn Thông tin', 
                cutoff2024: 26.77, 
                subjects: ['A00', 'A01', 'D07'], 
                minMath: 6.0,
                probabilities: {decrease_over_025: 0, decrease_0_025: 0, increase_0_025: 10, increase_025_05: 20, increase_05_075: 40, increase_075_1: 25, increase_over_1: 5}
            },
            {
                school: 'UIT',
                code: '7480106', 
                name: 'Kỹ thuật Máy tính', 
                cutoff2024: 26.25, 
                subjects: ['A00', 'A01'], 
                minMath: 6.5,
                probabilities: {decrease_over_025: 0, decrease_0_025: 0, increase_0_025: 10, increase_025_05: 30, increase_05_075: 40, increase_075_1: 15, increase_over_1: 5}
            },
            {
                school: 'UIT',
                code: '7480122', 
                name: 'Thương mại Điện tử', 
                cutoff2024: 26.12, 
                subjects: ['A00', 'A01', 'D01'], 
                minMath: 6.0,
                probabilities: {decrease_over_025: 0, decrease_0_025: 5, increase_0_025: 15, increase_025_05: 40, increase_05_075: 30, increase_075_1: 10, increase_over_1: 0}
            },
            {
                school: 'UIT',
                code: '7480102', 
                name: 'Mạng máy tính và Truyền thông dữ liệu', 
                cutoff2024: 25.7, 
                subjects: ['A00', 'A01', 'D07'], 
                minMath: 6.0,
                probabilities: {decrease_over_025: 0, decrease_0_025: 5, increase_0_025: 20, increase_025_05: 45, increase_05_075: 25, increase_075_1: 5, increase_over_1: 0}
            },
            {
                school: 'UIT',
                code: '7480104', 
                name: 'Hệ thống Thông tin (Chương trình tiên tiến)', 
                cutoff2024: 25.55, 
                subjects: ['A00', 'A01', 'D07'], 
                minMath: 6.0,
                probabilities: {decrease_over_025: 0, decrease_0_025: 5, increase_0_025: 15, increase_025_05: 40, increase_05_075: 30, increase_075_1: 10, increase_over_1: 0}
            },
            {
                school: 'UIT',
                code: '7480201', 
                name: 'Công nghệ Thông tin (Chương trình Việt-Nhật)', 
                cutoff2024: 25.55, 
                subjects: ['A00', 'A01', 'D07'], 
                minMath: 6.0,
                probabilities: {decrease_over_025: 0, decrease_0_025: 0, increase_0_025: 10, increase_025_05: 25, increase_05_075: 40, increase_075_1: 20, increase_over_1: 5}
            },
            {
                school: 'UIT',
                code: '7480103', 
                name: 'Kỹ thuật Phần mềm', 
                cutoff2024: 24.2, 
                subjects: ['A00', 'A01', 'D07'], 
                minMath: 6.0,
                probabilities: {decrease_over_025: 0, decrease_0_025: 0, increase_0_025: 5, increase_025_05: 20, increase_05_075: 40, increase_075_1: 30, increase_over_1: 5}
            },
            {
                school: 'UIT',
                code: '7520207', 
                name: 'Thiết kế Vi mạch', 
                cutoff2024: 26.0, 
                subjects: ['A00', 'A01'], 
                minMath: 7.0,
                probabilities: {decrease_over_025: 0, decrease_0_025: 0, increase_0_025: 5, increase_025_05: 10, increase_05_075: 25, increase_075_1: 40, increase_over_1: 20}
            },
            {
                school: 'UIT',
                code: '7480103_CLC', 
                name: 'Kỹ thuật Phần mềm (Chất lượng cao)', 
                cutoff2024: 25.8, 
                subjects: ['A00', 'A01', 'D07'], 
                minMath: 6.5,
                probabilities: {decrease_over_025: 0, decrease_0_025: 0, increase_0_025: 10, increase_025_05: 20, increase_05_075: 40, increase_075_1: 25, increase_over_1: 5}
            }
        ];

        // DỮ LIỆU MỚI TỪ FILE CSV
        const hcmusMajors = [
             // Dữ liệu cũ được giữ lại
            { school: 'HCMUS', code: '7480105', name: 'Khoa học máy tính (Chương trình Tiên tiến)', cutoff2024: 28.5, subjects: ['A00', 'A01', 'D07'], minMath: 7.0, probabilities: {decrease_over_025: 0, decrease_0_025: 0, increase_0_025: 5, increase_025_05: 15, increase_05_075: 30, increase_075_1: 40, increase_over_1: 10} },
            { school: 'HCMUS', code: '7480207', name: 'Trí tuệ Nhân tạo', cutoff2024: 27.7, subjects: ['A00', 'A01', 'D07'], minMath: 6.5, probabilities: {decrease_over_025: 0, decrease_0_025: 0, increase_0_025: 0, increase_025_05: 5, increase_05_075: 20, increase_075_1: 35, increase_over_1: 40} },
            // Dữ liệu mới từ file
            { school: 'HCMUS', code: 'QHT01', name: 'Nhóm ngành Vật lý học, Công nghệ Vật lý điện tử và tin học', cutoff2024: 25.10, subjects: ['A00', 'A01', 'D07'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 5, increase_0_025: 15, increase_025_05: 40, increase_05_075: 30, increase_075_1: 10, increase_over_1: 0 } },
            { school: 'HCMUS', code: 'QHT02', name: 'Vật lý học (CT tăng cường tiếng Anh)', cutoff2024: 23.00, subjects: ['A00', 'A01', 'D07'], minMath: 5.0, probabilities: { decrease_over_025: 5, decrease_0_025: 15, increase_0_025: 40, increase_025_05: 30, increase_075_1: 0, increase_over_1: 0, increase_05_075: 10 } },
            { school: 'HCMUS', code: 'QHT03', name: 'Hải dương học', cutoff2024: 20.00, subjects: ['A00', 'B00', 'D07'], minMath: 5.0, probabilities: { decrease_over_025: 15, decrease_0_025: 45, increase_0_025: 30, increase_025_05: 10, increase_05_075: 0, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'HCMUS', code: 'QHT04', name: 'Hóa học', cutoff2024: 25.42, subjects: ['A00', 'B00', 'D07'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 10, increase_0_025: 25, increase_025_05: 40, increase_05_075: 20, increase_075_1: 5, increase_over_1: 0 } },
            { school: 'HCMUS', code: 'QHT05', name: 'Hóa học (CT tăng cường tiếng Anh)', cutoff2024: 24.65, subjects: ['A00', 'B00', 'D07'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 10, increase_0_025: 25, increase_025_05: 45, increase_05_075: 15, increase_075_1: 5, increase_over_1: 0 } },
            { school: 'HCMUS', code: 'QHT06', name: 'Khoa học Vật liệu', cutoff2024: 22.30, subjects: ['A00', 'A01', 'D07'], minMath: 5.0, probabilities: { decrease_over_025: 10, decrease_0_025: 40, increase_0_025: 35, increase_025_05: 15, increase_05_075: 0, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'HCMUS', code: 'QHT07', name: 'Sinh học', cutoff2024: 23.00, subjects: ['B00', 'B08'], minMath: 5.0, probabilities: { decrease_over_025: 5, decrease_0_025: 20, increase_0_025: 40, increase_025_05: 30, increase_05_075: 5, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'HCMUS', code: 'QHT08', name: 'Công nghệ sinh học', cutoff2024: 25.00, subjects: ['B00', 'B08', 'A00'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 10, increase_0_025: 30, increase_025_05: 40, increase_05_075: 15, increase_075_1: 5, increase_over_1: 0 } },
            { school: 'HCMUS', code: 'QHT09', name: 'Khoa học Môi trường', cutoff2024: 21.00, subjects: ['A00', 'B00', 'D07'], minMath: 5.0, probabilities: { decrease_over_025: 15, decrease_0_025: 45, increase_0_025: 30, increase_025_05: 10, increase_05_075: 0, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'HCMUS', code: 'QHT10', name: 'Khoa học Môi trường (CT tăng cường tiếng Anh)', cutoff2024: 20.00, subjects: ['A00', 'B00', 'D07'], minMath: 5.0, probabilities: { decrease_over_025: 20, decrease_0_025: 50, increase_0_025: 25, increase_025_05: 5, increase_05_075: 0, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'HCMUS', code: 'QHT11', name: 'Địa chất học', cutoff2024: 18.00, subjects: ['A00', 'B00', 'D07'], minMath: 5.0, probabilities: { decrease_over_025: 25, decrease_0_025: 55, increase_0_025: 20, increase_025_05: 0, increase_05_075: 0, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'HCMUS', code: 'QHT12', name: 'Nhóm ngành Toán - Thống kê', cutoff2024: 25.75, subjects: ['A00', 'A01', 'D07'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 5, increase_0_025: 20, increase_025_05: 40, increase_05_075: 30, increase_075_1: 5, increase_over_1: 0 } },
            { school: 'HCMUS', code: 'QHT13', name: 'Toán học (CT tăng cường tiếng Anh)', cutoff2024: 24.50, subjects: ['A00', 'A01', 'D07'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 10, increase_0_025: 30, increase_025_05: 40, increase_05_075: 15, increase_075_1: 5, increase_over_1: 0 } },
            { school: 'HCMUS', code: 'QHT14', name: 'Nhóm ngành Công nghệ thông tin', cutoff2024: 27.00, subjects: ['A00', 'A01', 'D07'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 0, increase_0_025: 10, increase_025_05: 25, increase_05_075: 40, increase_075_1: 20, increase_over_1: 5 } },
            { school: 'HCMUS', code: 'QHT15', name: 'Khoa học Dữ liệu (CT Tiên tiến)', cutoff2024: 26.75, subjects: ['A00', 'A01', 'D07'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 5, increase_0_025: 15, increase_025_05: 35, increase_05_075: 30, increase_075_1: 15, increase_over_1: 0 } },
            { school: 'HCMUS', code: 'QHT16', name: 'Kỹ thuật Điện tử - Viễn thông', cutoff2024: 25.25, subjects: ['A00', 'A01', 'D07'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 10, increase_0_025: 30, increase_025_05: 40, increase_05_075: 15, increase_075_1: 5, increase_over_1: 0 } },
            { school: 'HCMUS', code: 'QHT17', name: 'Kỹ thuật Điện tử - Viễn thông (CT tăng cường tiếng Anh)', cutoff2024: 24.50, subjects: ['A00', 'A01', 'D07'], minMath: 5.0, probabilities: { decrease_over_025: 5, decrease_0_025: 15, increase_0_025: 40, increase_025_05: 30, increase_05_075: 10, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'HCMUS', code: 'QHT18', name: 'Công nghệ Kỹ thuật Môi trường', cutoff2024: 20.50, subjects: ['A00', 'B00', 'D07'], minMath: 5.0, probabilities: { decrease_over_025: 15, decrease_0_025: 45, increase_0_025: 30, increase_025_05: 10, increase_05_075: 0, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'HCMUS', code: 'QHT19', name: 'Quản lý tài nguyên và môi trường', cutoff2024: 20.50, subjects: ['A00', 'B00', 'D07'], minMath: 5.0, probabilities: { decrease_over_025: 15, decrease_0_025: 45, increase_0_025: 30, increase_025_05: 10, increase_05_075: 0, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'HCMUS', code: 'QHT20', name: 'Công nghệ vật liệu', cutoff2024: 23.50, subjects: ['A00', 'A01', 'D07'], minMath: 5.0, probabilities: { decrease_over_025: 5, decrease_0_025: 20, increase_0_025: 40, increase_025_05: 30, increase_05_075: 5, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'HCMUS', code: 'QHT21', name: 'Kỹ thuật địa chất', cutoff2024: 17.00, subjects: ['A00', 'B00', 'D07'], minMath: 5.0, probabilities: { decrease_over_025: 30, decrease_0_025: 50, increase_0_025: 20, increase_025_05: 0, increase_05_075: 0, increase_075_1: 0, increase_over_1: 0 } }
        ];

        const spktMajors = [
            // Dữ liệu cũ được giữ lại và cập nhật
            { school: 'SPKT', code: '7140231', name: 'Sư phạm Tiếng Anh', cutoff2024: 27.5, subjects: ['D01', 'D96', 'D09'], minMath: 6.0, probabilities: {decrease_over_025: 0, decrease_0_025: 5, increase_0_025: 20, increase_025_05: 30, increase_05_075: 35, increase_075_1: 10, increase_over_1: 0} },
            { school: 'SPKT', code: '7210403V', name: 'Thiết kế đồ họa (Hệ đại trà)', cutoff2024: 26.5, subjects: ['A00', 'D01', 'V00'], minMath: 5.5, probabilities: {decrease_over_025: 5, decrease_0_025: 15, increase_0_025: 40, increase_025_05: 35, increase_05_075: 5, increase_075_1: 0, increase_over_1: 0} },
            { school: 'SPKT', code: '7480201V', name: 'Công nghệ thông tin (Hệ đại trà)', cutoff2024: 25.97, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 5, increase_0_025: 20, increase_025_05: 35, increase_05_075: 35, increase_075_1: 5, increase_over_1: 0 } },
            { school: 'SPKT', code: '7480201A', name: 'Công nghệ thông tin (Chất lượng cao tiếng Anh)', cutoff2024: 25.65, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 5, increase_0_025: 20, increase_025_05: 40, increase_05_075: 30, increase_075_1: 5, increase_over_1: 0 } },
            { school: 'SPKT', code: '7510303V', name: 'Công nghệ kỹ thuật điều khiển và tự động hóa (Hệ đại trà)', cutoff2024: 26.14, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 5, increase_0_025: 20, increase_025_05: 30, increase_05_075: 35, increase_075_1: 10, increase_over_1: 0 } },
            { school: 'SPKT', code: '7510303A', name: 'Công nghệ kỹ thuật điều khiển và tự động hóa (Chất lượng cao tiếng Anh)', cutoff2024: 25.35, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 5, increase_0_025: 20, increase_025_05: 30, increase_05_075: 35, increase_075_1: 10, increase_over_1: 0 } },
            { school: 'SPKT', code: '7510205V', name: 'Công nghệ kỹ thuật ô tô (Hệ đại trà)', cutoff2024: 25.39, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 5, increase_0_025: 20, increase_025_05: 35, increase_05_075: 35, increase_075_1: 5, increase_over_1: 0 } },
            { school: 'SPKT', code: '7510205A', name: 'Công nghệ kỹ thuật ô tô (Chất lượng cao tiếng Anh)', cutoff2024: 24.75, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 5, increase_0_025: 20, increase_025_05: 35, increase_05_075: 35, increase_075_1: 5, increase_over_1: 0 } },
            { school: 'SPKT', code: '7510201V', name: 'Công nghệ kỹ thuật cơ khí (Hệ đại trà)', cutoff2024: 25.1, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 5, decrease_0_025: 15, increase_0_025: 30, increase_025_05: 40, increase_05_075: 10, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7510201A', name: 'Công nghệ kỹ thuật cơ khí (Chất lượng cao tiếng Anh)', cutoff2024: 24.25, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 5, decrease_0_025: 15, increase_0_025: 30, increase_025_05: 40, increase_05_075: 10, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7510301V', name: 'Công nghệ kỹ thuật điện, điện tử (Hệ đại trà)', cutoff2024: 25.12, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 5, decrease_0_025: 15, increase_0_025: 30, increase_025_05: 40, increase_05_075: 10, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7510301A', name: 'Công nghệ kỹ thuật điện, điện tử (Chất lượng cao tiếng Anh)', cutoff2024: 24.5, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 5, decrease_0_025: 15, increase_0_025: 30, increase_025_05: 40, increase_05_075: 10, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7340405', name: 'Logistics và quản lý chuỗi cung ứng', cutoff2024: 25.21, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 5, increase_0_025: 15, increase_025_05: 30, increase_05_075: 40, increase_075_1: 10, increase_over_1: 0 } },
            { school: 'SPKT', code: '7340101V', name: 'Quản trị kinh doanh (Hệ đại trà)', cutoff2024: 25.75, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 10, increase_0_025: 25, increase_025_05: 40, increase_05_075: 20, increase_075_1: 5, increase_over_1: 0 } },
            { school: 'SPKT', code: '7340101A', name: 'Quản trị kinh doanh (Chất lượng cao tiếng Anh)', cutoff2024: 24.75, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 5, decrease_0_025: 15, increase_0_025: 40, increase_025_05: 30, increase_05_075: 10, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7220201V', name: 'Ngôn ngữ Anh (Hệ đại trà)', cutoff2024: 24.57, subjects: ['D01', 'D96', 'D09'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 5, increase_0_025: 25, increase_025_05: 40, increase_05_075: 25, increase_075_1: 5, increase_over_1: 0 } },
            { school: 'SPKT', code: '7340301V', name: 'Kế toán (Hệ đại trà)', cutoff2024: 22.75, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 5, decrease_0_025: 20, increase_0_025: 40, increase_025_05: 30, increase_05_075: 5, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7540101V', name: 'Công nghệ thực phẩm (Hệ đại trà)', cutoff2024: 24.2, subjects: ['A00', 'A01', 'B00', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 10, decrease_0_025: 25, increase_0_025: 40, increase_025_05: 25, increase_075_1: 0, increase_over_1: 0, increase_05_075: 0 } },
            { school: 'SPKT', code: '7540101A', name: 'Công nghệ thực phẩm (Chất lượng cao tiếng Anh)', cutoff2024: 22.5, subjects: ['A00', 'A01', 'B00', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 10, decrease_0_025: 25, increase_0_025: 40, increase_025_05: 25, increase_05_075: 0, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7510203V', name: 'Công nghệ kỹ thuật cơ điện tử (Hệ đại trà)', cutoff2024: 25.45, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 10, increase_0_025: 25, increase_025_05: 40, increase_05_075: 20, increase_075_1: 5, increase_over_1: 0 } },
            { school: 'SPKT', code: '7510203A', name: 'Công nghệ kỹ thuật cơ điện tử (Chất lượng cao tiếng Anh)', cutoff2024: 25.1, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 10, increase_0_025: 25, increase_025_05: 40, increase_05_075: 20, increase_075_1: 5, increase_over_1: 0 } },
            { school: 'SPKT', code: '7510102V', name: 'Kỹ thuật xây dựng (Công nghệ kỹ thuật công trình xây dựng)', cutoff2024: 23.05, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 10, decrease_0_025: 30, increase_0_025: 45, increase_025_05: 15, increase_05_075: 0, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7210403A', name: 'Thiết kế đồ họa (Chất lượng cao tiếng Anh)', cutoff2024: 25.5, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 10, increase_0_025: 30, increase_025_05: 40, increase_05_075: 15, increase_075_1: 5, increase_over_1: 0 } },
            { school: 'SPKT', code: '7340122', name: 'Thương mại điện tử', cutoff2024: 23.0, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 10, increase_0_025: 20, increase_025_05: 40, increase_05_075: 25, increase_075_1: 5, increase_over_1: 0 } },
            { school: 'SPKT', code: '7510406V', name: 'Công nghệ kỹ thuật môi trường', cutoff2024: 22.0, subjects: ['A00', 'A01', 'B00', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 20, decrease_0_025: 50, increase_0_025: 25, increase_025_05: 5, increase_05_075: 0, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7520117', name: 'Kỹ thuật hệ thống công nghiệp', cutoff2024: 23.88, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 5, decrease_0_025: 20, increase_0_025: 45, increase_025_05: 25, increase_05_075: 5, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7510205N', name: 'Công nghệ kỹ thuật ô tô (Chương trình Việt-Nhật)', cutoff2024: 25.0, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 5, increase_0_025: 20, increase_025_05: 35, increase_05_075: 35, increase_075_1: 5, increase_over_1: 0 } },
            { school: 'SPKT', code: '7510601V', name: 'Quản lý công nghiệp (Hệ đại trà)', cutoff2024: 24.2, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 5, decrease_0_025: 15, increase_0_025: 30, increase_025_05: 40, increase_05_075: 10, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7520212', name: 'Kỹ thuật y sinh (Điện tử y sinh)', cutoff2024: 24.15, subjects: ['A00', 'A01', 'B00', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 5, decrease_0_025: 15, increase_0_025: 30, increase_025_05: 40, increase_05_075: 10, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7580101V', name: 'Kiến trúc', cutoff2024: 22.97, subjects: ['A00', 'A01', 'D01', 'V00'], minMath: 5.0, probabilities: { decrease_over_025: 10, decrease_0_025: 20, increase_0_025: 40, increase_025_05: 30, increase_075_1: 0, increase_over_1: 0, increase_05_075: 0 } },
            { school: 'SPKT', code: '7580103', name: 'Kiến trúc nội thất', cutoff2024: 22.77, subjects: ['A00', 'A01', 'D01', 'V00'], minMath: 5.0, probabilities: { decrease_over_025: 10, decrease_0_025: 20, increase_0_025: 40, increase_025_05: 30, increase_05_075: 0, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7580205V', name: 'Kỹ thuật xây dựng công trình giao thông', cutoff2024: 21.55, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 15, decrease_0_025: 40, increase_0_025: 35, increase_025_05: 10, increase_05_075: 0, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7580302V', name: 'Quản lý xây dựng', cutoff2024: 22.17, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 10, decrease_0_025: 30, increase_0_025: 40, increase_025_05: 20, increase_05_075: 0, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7810103V', name: 'Quản trị nhà hàng và dịch vụ ăn uống (Hệ đại trà)', cutoff2024: 23.27, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 10, decrease_0_025: 25, increase_0_025: 45, increase_025_05: 20, increase_05_075: 0, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7840110', name: 'Quản lý và vận hành hạ tầng', cutoff2024: 21.22, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 15, decrease_0_025: 45, increase_0_025: 30, increase_025_05: 10, increase_05_075: 0, increase_075_1: 0, increase_over_1: 0 } },
            // Dữ liệu mới từ CSV
            { school: 'SPKT', code: '7140246V', name: 'Sư phạm Công nghệ', cutoff2024: 24.15, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 5, decrease_0_025: 15, increase_0_025: 45, increase_025_05: 30, increase_05_075: 5, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7210404V', name: 'Thiết kế thời trang', cutoff2024: 24.8, subjects: ['A00', 'D01', 'V00'], minMath: 5.0, probabilities: { decrease_over_025: 10, decrease_0_025: 30, increase_0_025: 40, increase_025_05: 20, increase_05_075: 0, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7310403V', name: 'Tâm lý học giáo dục', cutoff2024: 25.15, subjects: ['A00', 'D01', 'C00'], minMath: 5.0, probabilities: { decrease_over_025: 5, decrease_0_025: 15, increase_0_025: 40, increase_025_05: 35, increase_05_075: 5, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7340120V', name: 'Kinh doanh Quốc tế', cutoff2024: 22.75, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 10, increase_0_025: 25, increase_025_05: 40, increase_05_075: 20, increase_075_1: 5, increase_over_1: 0 } },
            { school: 'SPKT', code: '7380101V', name: 'Luật', cutoff2024: 25.12, subjects: ['A00', 'D01', 'C00'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 10, increase_0_025: 30, increase_025_05: 40, increase_05_075: 15, increase_075_1: 5, increase_over_1: 0 } },
            { school: 'SPKT', code: '7480108A', name: 'Công nghệ kỹ thuật máy tính (Chất lượng cao tiếng Anh)', cutoff2024: 25.4, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 10, increase_0_025: 25, increase_025_05: 40, increase_05_075: 20, increase_075_1: 5, increase_over_1: 0 } },
            { school: 'SPKT', code: '7480108V', name: 'Công nghệ kỹ thuật máy tính (Hệ đại trà)', cutoff2024: 25.5, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 10, increase_0_025: 25, increase_025_05: 40, increase_05_075: 20, increase_075_1: 5, increase_over_1: 0 } },
            { school: 'SPKT', code: '7480118V', name: 'Hệ thống nhúng và IoT', cutoff2024: 25.65, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 5, increase_0_025: 20, increase_025_05: 35, increase_05_075: 35, increase_075_1: 5, increase_over_1: 0 } },
            { school: 'SPKT', code: '7480201N', name: 'Công nghệ thông tin (Chương trình Việt-Nhật)', cutoff2024: 25.65, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 5, increase_0_025: 20, increase_025_05: 40, increase_05_075: 30, increase_075_1: 5, increase_over_1: 0 } },
            { school: 'SPKT', code: '7480202V', name: 'An toàn thông tin', cutoff2024: 24.89, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 5, increase_0_025: 20, increase_025_05: 40, increase_05_075: 30, increase_075_1: 5, increase_over_1: 0 } },
            { school: 'SPKT', code: '7480203V', name: 'Kỹ thuật dữ liệu', cutoff2024: 24.05, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 5, increase_0_025: 15, increase_025_05: 35, increase_05_075: 35, increase_075_1: 10, increase_over_1: 0 } },
            { school: 'SPKT', code: '7510102A', name: 'Công nghệ kỹ thuật công trình xây dựng (Chất lượng cao tiếng Anh)', cutoff2024: 21.0, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 15, decrease_0_025: 40, increase_0_025: 35, increase_025_05: 10, increase_05_075: 0, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7210104', name: 'Hệ thống kỹ thuật công trình xây dựng', cutoff2024: 22.22, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 10, decrease_0_025: 30, increase_0_025: 45, increase_025_05: 15, increase_05_075: 0, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7510202A', name: 'Công nghệ chế tạo máy (Chất lượng cao tiếng Anh)', cutoff2024: 23.0, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 10, decrease_0_025: 30, increase_0_025: 45, increase_025_05: 15, increase_05_075: 0, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7510202N', name: 'Công nghệ chế tạo máy (Chương trình Việt-Nhật)', cutoff2024: 23.75, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 10, decrease_0_025: 30, increase_0_025: 45, increase_025_05: 15, increase_05_075: 0, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7510202V', name: 'Công nghệ chế tạo máy (Hệ đại trà)', cutoff2024: 24.27, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 10, decrease_0_025: 30, increase_0_025: 45, increase_025_05: 15, increase_05_075: 0, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7510206A', name: 'Công nghệ kỹ thuật nhiệt (Chất lượng cao tiếng Anh)', cutoff2024: 21.0, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 15, decrease_0_025: 40, increase_0_025: 35, increase_025_05: 10, increase_05_075: 0, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7510206N', name: 'Công nghệ kỹ thuật nhiệt (Chương trình Việt-Nhật)', cutoff2024: 24.4, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 10, decrease_0_025: 30, increase_0_025: 40, increase_025_05: 20, increase_05_075: 0, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7510206V', name: 'Công nghệ kỹ thuật nhiệt (Hệ đại trà)', cutoff2024: 24.4, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 10, decrease_0_025: 30, increase_0_025: 40, increase_025_05: 20, increase_05_075: 0, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7510208V', name: 'Năng lượng tái tạo', cutoff2024: 23.15, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 10, decrease_0_025: 30, increase_0_025: 40, increase_025_05: 20, increase_05_075: 0, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7510209V', name: 'Robot và trí tuệ nhân tạo', cutoff2024: 25.66, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 5, increase_0_025: 15, increase_025_05: 30, increase_05_075: 40, increase_075_1: 10, increase_over_1: 0 } },
            { school: 'SPKT', code: '7510302A', name: 'Công nghệ kỹ thuật điện tử, viễn thông (Chất lượng cao tiếng Anh)', cutoff2024: 24.35, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 5, decrease_0_025: 15, increase_0_025: 30, increase_025_05: 40, increase_05_075: 10, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7510302N', name: 'Công nghệ kỹ thuật điện tử, viễn thông (Chương trình Việt-Nhật)', cutoff2024: 24.0, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 5, decrease_0_025: 15, increase_0_025: 30, increase_025_05: 40, increase_05_075: 10, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7520208V', name: 'Kỹ thuật Thiết kế Vi mạch', cutoff2024: 25.95, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 0, decrease_0_025: 5, increase_0_025: 15, increase_025_05: 30, increase_05_075: 35, increase_075_1: 10, increase_over_1: 0 } },
            { school: 'SPKT', code: '7510302V', name: 'Công nghệ kỹ thuật điện tử, viễn thông (Hệ đại trà)', cutoff2024: 25.15, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 5, decrease_0_025: 15, increase_0_025: 30, increase_025_05: 40, increase_05_075: 10, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7510401V', name: 'Công nghệ kỹ thuật hóa học', cutoff2024: 24.9, subjects: ['A00', 'A01', 'B00', 'D07'], minMath: 5.0, probabilities: { decrease_over_025: 5, decrease_0_025: 20, increase_0_025: 40, increase_025_05: 30, increase_05_075: 5, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7510402V', name: 'Công nghệ vật liệu', cutoff2024: 23.33, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 10, decrease_0_025: 40, increase_0_025: 35, increase_025_05: 15, increase_05_075: 0, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7510601A', name: 'Quản lý công nghiệp (Chất lượng cao tiếng Anh)', cutoff2024: 23.05, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 5, decrease_0_025: 15, increase_0_025: 30, increase_025_05: 40, increase_05_075: 10, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7510801V', name: 'Công nghệ kỹ thuật in', cutoff2024: 22.0, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: { decrease_over_025: 20, decrease_0_025: 50, increase_0_025: 25, increase_025_05: 5, increase_05_075: 0, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7540209V', name: 'Công nghệ may', cutoff2024: 21.41, subjects: ['A00', 'A01', 'D01'], minMath: 5.0, probabilities: { decrease_over_025: 15, decrease_0_025: 40, increase_0_025: 35, increase_025_05: 10, increase_05_075: 0, increase_075_1: 0, increase_over_1: 0 } },
            { school: 'SPKT', code: '7540210', name: 'Kỹ nghệ gỗ và nội thất', cutoff2024: 20.5, subjects: ['A00', 'A01', 'D01', 'V00'], minMath: 5.0, probabilities: { decrease_over_025: 25, decrease_0_025: 55, increase_0_025: 20, increase_025_05: 0, increase_05_075: 0, increase_075_1: 0, increase_over_1: 0 } }
        ];

        const fptMajors = [
            // Dữ liệu cũ được giữ lại
            { school: 'FPT', code: '7480201', name: 'Công nghệ thông tin', cutoff2024: 21.00, subjects: ['A00', 'A01', 'D01', 'D07'], minMath: 5.0, probabilities: null },
            // Dữ liệu mới từ file
            { school: 'FPT', code: 'FPT01', name: 'Kỹ thuật phần mềm', cutoff2024: 21.00, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: null },
            { school: 'FPT', code: 'FPT02', name: 'An toàn thông tin', cutoff2024: 21.00, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: null },
            { school: 'FPT', code: 'FPT03', name: 'Trí tuệ nhân tạo', cutoff2024: 21.00, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: null },
            { school: 'FPT', code: 'FPT04', name: 'Thiết kế Mỹ thuật số', cutoff2024: 21.00, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: null },
            { school: 'FPT', code: 'FPT05', name: 'Quản trị kinh doanh', cutoff2024: 21.00, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: null },
            { school: 'FPT', code: 'FPT06', name: 'Kinh doanh quốc tế', cutoff2024: 21.00, subjects: ['A00', 'A01', 'D01', 'D90'], minMath: 5.0, probabilities: null },
            { school: 'FPT', code: 'FPT07', name: 'Ngôn ngữ Anh', cutoff2024: 21.00, subjects: ['A01', 'D01', 'D96'], minMath: 5.0, probabilities: null },
            { school: 'FPT', code: 'FPT08', name: 'Ngôn ngữ Nhật', cutoff2024: 21.00, subjects: ['A01', 'D01', 'D96'], minMath: 5.0, probabilities: null },
            { school: 'FPT', code: 'FPT09', name: 'Ngôn ngữ Hàn Quốc', cutoff2024: 21.00, subjects: ['A01', 'D01', 'D96'], minMath: 5.0, probabilities: null }
        ];

        // Kết hợp tất cả ngành
        const allMajors = [...uitMajors, ...hcmusMajors, ...spktMajors, ...fptMajors];

        // Tổ hợp xét tuyển
        const combinations = {
            'A00': ['toan', 'ly', 'hoa'],     
            'A01': ['toan', 'ly', 'anh'],    
            'A02': ['toan', 'hoa', 'sinh'],
            'B00': ['toan', 'hoa', 'sinh'],
            'B03': ['toan', 'sinh', 'hoa'],
            'B08': ['toan', 'sinh', 'hoa'],
            'C00': ['van', 'su', 'dia'],
            'D01': ['toan', 'van', 'anh'],   
            'D07': ['toan', 'hoa', 'anh'],
            'D90': ['toan', 'anh', 'ly'], // Giả định cho SPKT
            'D96': ['toan', 'anh', 'su'], // Giả định cho FPT
            'V00': ['van', 'ly', 'anh']
        };

        let wishList = [];
        let cutoff2025Generated = {};
        let admissionProcessed = false;
        let paymentCompleted = false;
        let currentUserName = 'NGUYỄN VĂN A';
        let draggedIndex = null;
        
        // Điểm ưu tiên các khu vực theo quy định chính thức
        const areaBonus = {
            'KV1': 0.75,    
            'KV2NT': 0.5,   
            'KV2': 0.25,    
            'KV3': 0        
        };

        // Khởi tạo
        document.addEventListener('DOMContentLoaded', function() {
            updateWishStats();
            updateAreaInfo();
            populateAiWishSelectors();
            console.log('🎓 Hệ thống hoàn chỉnh - ' + allMajors.length + ' ngành từ 4 trường!');
        });

        // Thông báo hài hước cho nút trang trí
        function showDecorativeAlert() {
            showToast('Nút để trang trí, Không bấm được nha 🤣');
        }

        // Hiển thị toast notification
        function showToast(message) {
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }

            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.classList.add('fade-out');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // Hiển thị modal hướng dẫn
        function showGuide() {
            document.getElementById('guideModal').style.display = 'block';
        }

        function closeGuideModal() {
            document.getElementById('guideModal').style.display = 'none';
        }

        // Chức năng chỉnh sửa thông tin cá nhân
        function editInfo(valueId, editId) {
            const valueElement = document.getElementById(valueId);
            const editElement = document.getElementById(editId);
            const editControls = editElement.parentNode.querySelector('.edit-controls');
            const editBtn = editElement.parentNode.querySelector('.edit-btn');
            
            valueElement.style.display = 'none';
            editElement.style.display = 'flex';
            editControls.style.display = 'flex';
            editBtn.style.display = 'none';
            editElement.focus();
        }

        function saveInfo(valueId, editId) {
            const valueElement = document.getElementById(valueId);
            const editElement = document.getElementById(editId);
            const newValue = editElement.value.trim();
            
            if (newValue !== '') {
                valueElement.textContent = newValue;
                
                if (valueId === 'userNameInfo') {
                    currentUserName = newValue;
                    document.getElementById('userName').textContent = newValue;
                }
                
                cancelEdit(valueId, editId);
            } else {
                alert('⚠️ Vui lòng nhập thông tin hợp lệ!');
            }
        }

        function cancelEdit(valueId, editId) {
            const valueElement = document.getElementById(valueId);
            const editElement = document.getElementById(editId);
            const editControls = editElement.parentNode.querySelector('.edit-controls');
            const editBtn = editElement.parentNode.querySelector('.edit-btn');
            
            valueElement.style.display = 'inline';
            editElement.style.display = 'none';
            editControls.style.display = 'none';
            editBtn.style.display = 'inline-block';
        }

        // Chức năng sửa tên
        function editName() {
            document.getElementById('editNameInput').value = currentUserName;
            document.getElementById('editNameInput').style.display = 'flex';
            document.getElementById('editNameButtons').style.display = 'flex';
            document.getElementById('editNameBtn').style.display = 'none';
            document.getElementById('editNameInput').focus();
        }

        function saveNewName() {
            const newName = document.getElementById('editNameInput').value.trim();
            if (newName && newName !== '') {
                currentUserName = newName;
                document.getElementById('userName').textContent = newName;
                document.getElementById('userNameInfo').textContent = newName;
                cancelEditName();
                showToast(`✅ Tên đã được cập nhật thành: ${newName}`);
            } else {
                alert('⚠️ Vui lòng nhập tên hợp lệ!');
            }
        }

        function cancelEditName() {
            document.getElementById('editNameInput').style.display = 'none';
            document.getElementById('editNameButtons').style.display = 'none';
            document.getElementById('editNameBtn').style.display = 'inline-block';
        }

        // Cập nhật thông tin khu vực
        function updateAreaInfo() {
            const areaSelect = document.getElementById('areaSelect');
            const currentBonusInfo = document.getElementById('currentBonusInfo');
            const selectedArea = areaSelect.value;
            const bonus = areaBonus[selectedArea];
            
            if (bonus > 0) {
                currentBonusInfo.textContent = `+${bonus} điểm (giảm dần nếu tổng điểm ≥22.5)`;
            } else {
                currentBonusInfo.textContent = `${bonus} điểm (không được ưu tiên)`;
            }
        }

        // Cập nhật dropdown ngành theo trường
        function updateMajorSelect() {
            const schoolSelect = document.getElementById('schoolSelect');
            const majorSelect = document.getElementById('majorSelect');
            
            majorSelect.innerHTML = '<option value="">-- Chọn ngành --</option>';
            
            if (schoolSelect.value) {
                majorSelect.disabled = false;
                const schoolMajors = allMajors.filter(m => m.school === schoolSelect.value);
                schoolMajors.forEach(major => {
                    const option = document.createElement('option');
                    option.value = major.school + '_' + major.code;
                    option.textContent = `${major.name} (${major.code})`;
                    majorSelect.appendChild(option);
                });
            } else {
                majorSelect.disabled = true;
            }
            checkGeminiButtons();
        }

        // Cập nhật inputs môn học
        function updateSubjectInputs() {
            const subject1 = document.getElementById('subject1').value;
            const subject2 = document.getElementById('subject2').value;
            const score1Input = document.getElementById('score1');
            const score2Input = document.getElementById('score2');
            
            score1Input.disabled = !subject1;
            score2Input.disabled = !subject2;
            
            if (!subject1) score1Input.value = '';
            if (!subject2) score2Input.value = '';
            
            if (subject1 && subject2 && subject1 === subject2) {
                alert('⚠️ Hai môn tự chọn không được trùng nhau!');
                document.getElementById('subject2').value = '';
                score2Input.disabled = true;
                score2Input.value = '';
            }
            checkGeminiButtons();
        }

        // Hiển thị điểm chuẩn 2024 theo trường
        function showCutoff2024(school) {
            const modal = document.getElementById('cutoff2024Modal');
            const title = document.getElementById('cutoffModalTitle');
            const tableBody = document.getElementById('cutoff2024TableBody');
            
            let schoolName = '';
            let schoolData = [];
            
            switch(school) {
                case 'UIT':
                    schoolName = 'UIT';
                    schoolData = uitMajors;
                    break;
                case 'HCMUS':
                    schoolName = 'HCMUS';  
                    schoolData = hcmusMajors;
                    break;
                case 'SPKT':
                    schoolName = 'SPKT';
                    schoolData = spktMajors;
                    break;
                case 'FPT':
                    schoolName = 'FPT';
                    schoolData = fptMajors;
                    break;
            }
            
            title.textContent = `📊 BẢNG ĐIỂM CHUẨN ${schoolName} NĂM 2024`;
            
            let html = '';
            schoolData.sort((a, b) => b.cutoff2024 - a.cutoff2024).forEach((major, index) => {
                html += `
                    <tr>
                        <td data-label="STT">${index + 1}</td>
                        <td data-label="Mã ngành">${major.code}</td>
                        <td data-label="Tên ngành">${major.name}</td>
                        <td data-label="Tổ hợp">${major.subjects.join(', ')}</td>
                        <td data-label="Điều kiện Toán">≥ ${major.minMath}</td>
                        <td data-label="Điểm chuẩn 2024" style="font-weight: bold; color: #337ab7;">${major.cutoff2024.toFixed(2)}</td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
            modal.style.display = 'block';
        }

        function closeCutoff2024Modal() {
            document.getElementById('cutoff2024Modal').style.display = 'none';
        }

        // Thêm nguyện vọng
        function addWish() {
            const schoolSelect = document.getElementById('schoolSelect');
            const majorSelect = document.getElementById('majorSelect');
            const majorKey = majorSelect.value;
            
            if (!schoolSelect.value || !majorKey) {
                alert('⚠️ Vui lòng chọn trường và ngành để thêm!');
                return;
            }

            if (wishList.some(wish => (wish.school + '_' + wish.code) === majorKey)) {
                alert('⚠️ Ngành này đã có trong danh sách nguyện vọng!');
                return;
            }

            const [school, code] = majorKey.split('_');
            const major = allMajors.find(m => m.school === school && m.code === code);
            
            if (major) {
                wishList.push({
                    ...major, 
                    wishOrder: wishList.length + 1
                });
                renderWishList();
                updateWishStats();
                updatePaymentInfo();
                majorSelect.value = '';
                checkGeminiButtons();
            }
        }

        // Hiển thị danh sách nguyện vọng với drag & drop đã sửa
        function renderWishList() {
            const container = document.getElementById('wishContainer');
            
            if (wishList.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; color: #666; padding: 15px;">
                        <p>🎯 <strong>Chưa có nguyện vọng nào</strong></p>
                        <p style="font-size: 9px;">Chọn trường và ngành, nhấn "Thêm" để bắt đầu!</p>
                    </div>
                `;
                return;
            }

            let html = '';
            wishList.forEach((wish, index) => {
                html += `
                    <div class="wish-item" draggable="true" 
                         onmousedown="startDrag(event, ${index})"
                         ondragstart="handleDragStart(event, ${index})" 
                         ondragover="handleDragOver(event)" 
                         ondrop="handleDrop(event, ${index})"
                         ondragend="handleDragEnd(event)">
                        <div class="drag-handle" title="Kéo để đổi vị trí">⋮⋮</div>
                        <div class="wish-number">${index + 1}</div>
                        <div class="wish-content">
                            <div class="wish-name">${wish.school} - ${wish.name}</div>
                            <div class="wish-details">
                                📊 ${wish.code} | 🎯 ${wish.subjects.join(', ')} | 📐 Toán ≥ ${wish.minMath} | 
                                📈 DC 2024: ${wish.cutoff2024.toFixed(2)}
                            </div>
                        </div>
                        <button class="remove-wish" onclick="removeWish(${index})" title="Xóa">✕</button>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Drag & Drop handlers đã sửa lỗi
        function startDrag(e, index) {
            draggedIndex = index;
        }

        function handleDragStart(e, index) {
            draggedIndex = index;
            e.currentTarget.classList.add('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
            const dropTarget = e.currentTarget;
            
            document.querySelectorAll('.wish-item').forEach(item => {
                item.classList.remove('drag-over');
            });
            
            if (dropTarget && dropTarget.classList.contains('wish-item')) {
                dropTarget.classList.add('drag-over');
            }
        }

        function handleDrop(e, dropIndex) {
            e.preventDefault();
            
            if (draggedIndex !== null && draggedIndex !== dropIndex) {
                const draggedItem = wishList[draggedIndex];
                wishList.splice(draggedIndex, 1);
                wishList.splice(dropIndex, 0, draggedItem);
                
                wishList.forEach((wish, i) => {
                    wish.wishOrder = i + 1;
                });
                
                renderWishList();
                updateWishStats();
            }
        }

        function handleDragEnd(e) {
            document.querySelectorAll('.wish-item').forEach(item => {
                item.classList.remove('dragging', 'drag-over');
            });
            
            draggedIndex = null;
        }

        // Xóa nguyện vọng
        function removeWish(index) {
            if (confirm('🗑️ Xóa nguyện vọng này?')) {
                wishList.splice(index, 1);
                wishList.forEach((wish, i) => {
                    wish.wishOrder = i + 1;
                });
                renderWishList();
                updateWishStats();
                updatePaymentInfo();
                checkGeminiButtons();
            }
        }

        // Xóa tất cả
        function clearAllWishes() {
            if (wishList.length === 0) return;
            
            if (confirm('🗑️ Xóa tất cả nguyện vọng?')) {
                wishList = [];
                renderWishList();
                updateWishStats();
                updatePaymentInfo();
                paymentCompleted = false;
                document.getElementById('submitBtn').disabled = true;
                checkGeminiButtons();
            }
        }

        // Cập nhật thống kê
        function updateWishStats() {
            document.getElementById('totalWishes').textContent = wishList.length;
        }

        // Cập nhật thông tin thanh toán
        function updatePaymentInfo() {
            const paymentSection = document.getElementById('paymentSection');
            const paymentWishCount = document.getElementById('paymentWishCount');
            const paymentTotal = document.getElementById('paymentTotal');
            
            if (wishList.length > 0) {
                paymentSection.style.display = 'block';
                paymentWishCount.textContent = wishList.length;
                const total = wishList.length * 15000;
                paymentTotal.textContent = total.toLocaleString('vi-VN') + ' VNĐ';
                
                if (!paymentCompleted) {
                    document.getElementById('submitBtn').disabled = true;
                }
            } else {
                paymentSection.style.display = 'none';
                paymentCompleted = false;
                document.getElementById('submitBtn').disabled = true;
            }
        }

        // Xử lý thanh toán giả lập
        function processPayment() {
            if (wishList.length === 0) {
                alert('⚠️ Không có nguyện vọng nào để thanh toán!');
                return;
            }
            
            const total = wishList.length * 15000;
            const confirmMsg = `💰 Thanh toán ${total.toLocaleString('vi-VN')} VNĐ cho ${wishList.length} nguyện vọng?\n(Đây là thanh toán giả lập, không thu tiền thật)`;
            
            if (confirm(confirmMsg)) {
                setTimeout(() => {
                    paymentCompleted = true;
                    document.getElementById('submitBtn').disabled = false;
                    document.querySelector('.payment-section').style.background = '#dff0d8';
                    document.querySelector('.payment-section h5').innerHTML = '✅ THANH TOÁN THÀNH CÔNG';
                    showToast('✅ Thanh toán thành công! Có thể xét tuyển.');
                }, 1500);
            }
        }

        // Random điểm chuẩn 2025
        function generateCutoff2025() {
            cutoff2025Generated = {};

            allMajors.forEach(major => {
                const cutoffKey = major.school + '_' + major.code;
                
                // FPT không random, giữ nguyên điểm 2024
                if (major.school === 'FPT' || !major.probabilities) {
                    cutoff2025Generated[cutoffKey] = major.cutoff2024;
                    return;
                }
                
                // Các trường khác random theo xác suất
                const prob = major.probabilities;
                const rand = Math.random() * 100;
                let change = 0;
                let cumulative = 0;
                
                cumulative += prob.decrease_over_025;
                if (rand < cumulative) {
                    change = -0.25 - Math.random() * 0.25;
                    cutoff2025Generated[cutoffKey] = Math.max(15, Math.round((major.cutoff2024 + change) * 100) / 100);
                    return;
                }
                
                cumulative += prob.decrease_0_025;
                if (rand < cumulative) {
                    change = -Math.random() * 0.25;
                    cutoff2025Generated[cutoffKey] = Math.max(15, Math.round((major.cutoff2024 + change) * 100) / 100);
                    return;
                }
                
                cumulative += prob.increase_0_025;
                if (rand < cumulative) {
                    change = Math.random() * 0.25;
                    cutoff2025Generated[cutoffKey] = Math.max(15, Math.round((major.cutoff2024 + change) * 100) / 100);
                    return;
                }
                
                cumulative += prob.increase_025_05;
                if (rand < cumulative) {
                    change = 0.25 + Math.random() * 0.25;
                    cutoff2025Generated[cutoffKey] = Math.max(15, Math.round((major.cutoff2024 + change) * 100) / 100);
                    return;
                }
                
                cumulative += prob.increase_05_075;
                if (rand < cumulative) {
                    change = 0.5 + Math.random() * 0.25;
                    cutoff2025Generated[cutoffKey] = Math.max(15, Math.round((major.cutoff2024 + change) * 100) / 100);
                    return;
                }
                
                cumulative += prob.increase_075_1;
                if (rand < cumulative) {
                    change = 0.75 + Math.random() * 0.25;
                    cutoff2025Generated[cutoffKey] = Math.max(15, Math.round((major.cutoff2024 + change) * 100) / 100);
                    return;
                }
                
                // Tăng > 1.0 (tối đa 1.5)
                change = 1.0 + Math.random() * 0.5;
                cutoff2025Generated[cutoffKey] = Math.max(15, Math.round((major.cutoff2024 + change) * 100) / 100);
            });

            return cutoff2025Generated;
        }

        // Tính điểm ưu tiên theo công thức
        function calculateAreaBonus(totalScore) {
            const selectedArea = document.getElementById('areaSelect').value;
            const baseBonus = areaBonus[selectedArea];
            
            if (baseBonus === 0 || totalScore < 22.5) {
                return baseBonus;
            }
            
            const bonus = ((30 - totalScore) / 7.5) * baseBonus;
            return Math.max(0, Math.round(bonus * 1000) / 1000);
        }

        // Xử lý xét tuyển hoàn chỉnh - ĐÃ THÊM HIỆU ỨNG LOADING
        function processAdmissionComplete() {
            if (!paymentCompleted) {
                alert('⚠️ Vui lòng thanh toán trước khi xét tuyển!');
                return;
            }
            
            if (!validateForm()) {
                return;
            }

            const submitBtn = document.getElementById('submitBtn');
            const submitBtnText = document.getElementById('submitBtnText');
            const loadingContainer = document.getElementById('processLoadingContainer');

            // Bắt đầu loading
            submitBtn.disabled = true;
            submitBtnText.style.display = 'none';
            loadingContainer.style.display = 'inline-flex';
            
            setTimeout(() => {
                // Kết thúc loading
                submitBtnText.style.display = 'inline-block';
                loadingContainer.style.display = 'none';
                
                const cutoff2025 = generateCutoff2025();
                const scores = getScores();
                const result = performAdmissionComplete(scores, wishList, cutoff2025);
                
                showAdmissionResultComplete(result, scores, cutoff2025);
                admissionProcessed = true;
                
                // Reset trạng thái thanh toán
                paymentCompleted = false;
                document.querySelector('.payment-section').style.background = '#fff3cd';
                document.querySelector('.payment-section h5').innerHTML = '💳 THANH TOÁN NGUYỆN VỌNG (GIẢ LẬP)';
                
            }, 3000); // Chờ 3 giây
        }

        // Validation
        function validateForm() {
            if (!document.getElementById('toan').value || 
                !document.getElementById('van').value) {
                alert('⚠️ Vui lòng nhập đầy đủ điểm 2 môn bắt buộc!');
                return false;
            }
            
            if (!document.getElementById('subject1').value || 
                !document.getElementById('score1').value ||
                !document.getElementById('subject2').value || 
                !document.getElementById('score2').value) {
                alert('⚠️ Vui lòng chọn và nhập điểm 2 môn tự chọn!');
                return false;
            }
            
            if (wishList.length === 0) {
                alert('⚠️ Vui lòng chọn ít nhất một nguyện vọng!');
                return false;
            }
            
            return true;
        }

        // Lấy điểm từ form
        function getScores() {
            const subject1 = document.getElementById('subject1').value;
            const subject2 = document.getElementById('subject2').value;
            
            const baseScores = {
                'toan': parseFloat(document.getElementById('toan').value) || 0,
                'van': parseFloat(document.getElementById('van').value) || 0
            };
            
            baseScores[subject1] = parseFloat(document.getElementById('score1').value) || 0;
            baseScores[subject2] = parseFloat(document.getElementById('score2').value) || 0;
            
            return baseScores;
        }

        // Tính điểm theo tổ hợp
        function calculateScore(combination, scores) {
            const subjectCodes = combinations[combination];
            if (!subjectCodes) return { score: 0, areaBonus: 0, valid: false };
            
            let total = 0;
            for (let subject of subjectCodes) {
                if (scores[subject] !== undefined && scores[subject] !== null) {
                    total += parseFloat(scores[subject]);
                } else {
                    return { score: 0, areaBonus: 0, valid: false }; // Không đủ môn
                }
            }
            
            const areaBonusValue = calculateAreaBonus(total);
            total += areaBonusValue;
            
            return { score: total, areaBonus: areaBonusValue, valid: true };
        }

        // Xét tuyển hoàn chỉnh
        function performAdmissionComplete(scores, wishes, cutoff2025) {
            let result = {
                admitted: false,
                admittedMajor: null,
                admittedWishOrder: 0,
                bestScore: 0,
                bestCombination: '',
                areaBonus: 0,
                allResults: []
            };
            
            for (let i = 0; i < wishes.length; i++) {
                const wish = wishes[i];
                let bestScoreForWish = 0;
                let bestCombForWish = '';
                let bestAreaBonus = 0;
                let isValidCombination = false;
                
                for (let combination of wish.subjects) {
                    const scoreResult = calculateScore(combination, scores);
                    if (scoreResult.valid && scoreResult.score > bestScoreForWish) {
                        bestScoreForWish = scoreResult.score;
                        bestCombForWish = combination;
                        bestAreaBonus = scoreResult.areaBonus;
                        isValidCombination = true;
                    }
                }
                
                const mathOK = scores.toan >= wish.minMath;
                const cutoffKey = wish.school + '_' + wish.code;
                const cutoff2025Value = cutoff2025[cutoffKey];
                const passedCutoff = bestScoreForWish >= cutoff2025Value;
                const passed = isValidCombination && mathOK && passedCutoff;
                
                const wishResult = {
                    major: wish,
                    bestScore: bestScoreForWish,
                    bestCombination: bestCombForWish,
                    areaBonus: bestAreaBonus,
                    mathOK: mathOK,
                    passedCutoff: passedCutoff,
                    passed: passed,
                    cutoff2025: cutoff2025Value,
                    difference: bestScoreForWish - cutoff2025Value,
                    isValidCombination: isValidCombination
                };
                
                result.allResults.push(wishResult);
                
                if (passed) {
                    result.admitted = true;
                    result.admittedMajor = wish;
                    result.admittedWishOrder = wish.wishOrder;
                    result.bestScore = bestScoreForWish;
                    result.bestCombination = bestCombForWish;
                    result.areaBonus = bestAreaBonus;
                    break; // Dừng lại khi đã trúng tuyển 1 nguyện vọng
                }
            }
            
            return result;
        }

        // Hiển thị kết quả xét tuyển với SO SÁNH ĐIỂM chi tiết
        function showAdmissionResultComplete(result, scores, cutoff2025) {
            const modal = document.getElementById('resultModal');
            const modalBody = document.getElementById('modalBody');
            
            let html = '';
            
            if (result.admitted) {
                html += `
                    <div class="celebration">🎉</div>
                    <div class="admission-certificate">
                        <div class="university-logo">${result.admittedMajor.school}</div>
                        <h3 style="color: #337ab7; margin-bottom: 10px;">
                            GIẤY BÁO TRÚNG TUYỂN (MÔ PHỎNG)
                        </h3>
                        <p style="font-size: 12px; margin-bottom: 15px;">
                            <strong>${getSchoolFullName(result.admittedMajor.school)}</strong>
                        </p>
                        
                        <div style="background: white; padding: 12px; border-radius: 5px; margin: 15px 0; border: 1px solid #d6e9c6;">
                            <div style="text-align: left; font-size: 11px;">
                                <p><strong>👤 Thí sinh:</strong> ${currentUserName}</p>
                                <p><strong>🎯 Nguyện vọng trúng tuyển:</strong> ${result.admittedWishOrder}</p>
                                <p><strong>🏫 Trường:</strong> ${result.admittedMajor.school}</p>
                                <p><strong>📚 Ngành học:</strong> ${result.admittedMajor.name}</p>
                                <p><strong>🔢 Mã ngành:</strong> ${result.admittedMajor.code}</p>
                                <p><strong>📊 Tổ hợp xét tuyển:</strong> ${result.bestCombination}</p>
                                <p><strong>🎯 Tổng điểm xét tuyển:</strong> ${result.bestScore.toFixed(3)} điểm</p>
                                <p><strong>📈 Điểm chuẩn 2025:</strong> ${result.allResults[result.admittedWishOrder-1].cutoff2025.toFixed(2)} điểm</p>
                                <p><strong>🏘️ Khu vực:</strong> ${document.getElementById('areaSelect').value}</p>
                                <p><strong>➕ Điểm ưu tiên:</strong> ${result.areaBonus.toFixed(3)} điểm</p>
                            </div>
                            <div style="text-align: center; margin-top: 10px; padding: 8px; background: #dff0d8; border-radius: 3px;">
                                <strong style="color: #5cb85c; font-size: 12px;">
                                    🎊 CHÚC MỪNG! BẠN ĐÃ TRÚNG TUYỂN! 🎊
                                </strong>
                            </div>
                        </div>
                    </div>
                `;
                
                setTimeout(() => createConfetti(), 1000);
                
            } else {
                html += `
                    <div style="text-align: center; font-size: 28px; color: #f0ad4e; margin: 10px 0;">😔</div>
                    <div class="result-fail">
                        <h3 style="margin-bottom: 10px; font-size: 14px;">❌ RẤT TIẾC!</h3>
                        <p style="font-size: 11px;">Điểm số chưa đạt điểm chuẩn của các nguyện vọng.</p>
                    </div>
                `;
            }
            
            // Chi tiết SO SÁNH ĐIỂM từng nguyện vọng
            html += `
                <div style="margin-top: 15px;">
                    <h4 style="background: #f8f9fa; padding: 6px; border-left: 4px solid #337ab7; font-size: 12px;">
                        📊 SO SÁNH ĐIỂM ${wishList.length} NGUYỆN VỌNG
                    </h4>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>NV</th>
                                <th>Trường</th>
                                <th>Ngành</th>
                                <th>Tổ hợp</th>
                                <th>Điểm của bạn</th>
                                <th>DC 2025</th>
                                <th>Điều kiện</th>
                                <th>Kết quả</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            result.allResults.forEach((wishResult, index) => {
                let statusText, statusColor, reason;
                if (!wishResult.isValidCombination) {
                    statusText = '❌ Không đủ môn';
                    statusColor = '#d9534f';
                    reason = 'Không đủ môn cho tổ hợp';
                } else if (!wishResult.mathOK) {
                    statusText = '❌ Không đạt';
                    statusColor = '#d9534f';
                    reason = `Toán < ${wishResult.major.minMath}`;
                } else if (!wishResult.passedCutoff) {
                    statusText = '❌ Không đạt';
                    statusColor = '#d9534f';
                    reason = `Thấp hơn DC (${wishResult.difference.toFixed(2)})`;
                } else {
                    statusText = '✅ Trúng tuyển';
                    statusColor = '#5cb85c';
                    reason = `Cao hơn DC (+${wishResult.difference.toFixed(2)})`;
                }

                // Nếu đã trúng tuyển ở NV trước, các NV sau sẽ không xét
                if (result.admitted && wishResult.major.wishOrder > result.admittedWishOrder) {
                    statusText = '➖ Không xét';
                    statusColor = '#666';
                    reason = 'Đã trúng tuyển NV trước';
                }

                const bgColor = wishResult.passed && result.admitted && 
                              result.admittedMajor.code === wishResult.major.code ? 
                              '#dff0d8' : (index % 2 === 0 ? '#f9f9f9' : 'white');
                
                html += `
                    <tr>
                        <td data-label="NV" style="font-weight: bold;">
                            ${wishResult.major.wishOrder}
                            ${wishResult.passed && result.admitted && result.admittedMajor.code === wishResult.major.code ? ' 🏆' : ''}
                        </td>
                        <td data-label="Trường">${wishResult.major.school}</td>
                        <td data-label="Ngành">${wishResult.major.name}</td>
                        <td data-label="Tổ hợp">${wishResult.isValidCombination ? wishResult.bestCombination : 'N/A'}</td>
                        <td data-label="Điểm của bạn" style="font-weight: bold;">${wishResult.isValidCombination ? wishResult.bestScore.toFixed(3) : 'N/A'}</td>
                        <td data-label="ĐC 2025" style="font-weight: bold; color: #337ab7;">${wishResult.cutoff2025.toFixed(2)}</td>
                        <td data-label="Điều kiện">Toán ≥ ${wishResult.major.minMath}</td>
                        <td data-label="Kết quả">
                            <span style="color: ${statusColor}; font-weight: bold;">${statusText}</span>
                            <br><small style="color: ${statusColor}; font-size: 9px;">${reason}</small>
                        </td>
                    </tr>
                `;
            });
            
            html += `</tbody></table></div>`;
            
            // Thông tin điểm chi tiết
            const subject1Name = getSubjectName(document.getElementById('subject1').value);
            const subject2Name = getSubjectName(document.getElementById('subject2').value);
            const selectedArea = document.getElementById('areaSelect').value;
            const areaText = {
                'KV1': 'KV1 - Xã miền núi (+0.75)',
                'KV2NT': 'KV2-NT - Khu vực 2 nông thôn (+0.5)', 
                'KV2': 'KV2 - Thị xã, thành phố tỉnh (+0.25)',
                'KV3': 'KV3 - Quận nội thành TT TW (0)'
            };
            
            html += `
                <div style="margin-top: 12px; background: #f8f9fa; padding: 8px; border-radius: 3px; font-size: 10px;">
                    <h5 style="margin-bottom: 5px;">📋 THÔNG TIN XÉT TUYỂN:</h5>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 5px;">
                        <p><strong>👤 Thí sinh:</strong> ${currentUserName}</p>
                        <p><strong>📐 Toán:</strong> ${scores.toan}</p>
                        <p><strong>📖 Ngữ văn:</strong> ${scores.van}</p>
                        <p><strong>🎯 ${subject1Name}:</strong> ${scores[document.getElementById('subject1').value]}</p>
                        <p><strong>🎯 ${subject2Name}:</strong> ${scores[document.getElementById('subject2').value]}</p>
                        <p><strong>🏘️ Khu vực:</strong> ${areaText[selectedArea]}</p>
                        <p><strong>➕ Điểm ưu tiên:</strong> ${result.allResults[0] ? result.allResults[0].areaBonus.toFixed(3) : 'N/A'}</p>
                        <p><strong>💰 Thanh toán:</strong> ${(wishList.length * 15000).toLocaleString('vi-VN')} VNĐ</p>
                    </div>
                </div>
            `;
            
            modalBody.innerHTML = html;
            modal.style.display = 'block';
            
            // Hiển thị các nút bổ sung
            document.getElementById('viewCutoff2025Btn').style.display = 'inline-block';
            document.getElementById('viewRandomRatesBtn').style.display = 'inline-block';
        }

        // Lấy tên đầy đủ của trường
        function getSchoolFullName(school) {
            const fullNames = {
                'UIT': 'TRƯỜNG ĐẠI HỌC CÔNG NGHỆ THÔNG TIN<br>ĐẠI HỌC QUỐC GIA TP. HỒ CHÍ MINH',
                'HCMUS': 'TRƯỜNG ĐẠI HỌC KHOA HỌC TỰ NHIÊN<br>ĐẠI HỌC QUỐC GIA TP. HỒ CHÍ MINH',
                'SPKT': 'TRƯỜNG ĐẠI HỌC SƯ PHẠM KỸ THUẬT<br>THÀNH PHỐ HỒ CHÍ MINH',
                'FPT': 'TRƯỜNG ĐẠI HỌC FPT<br>THÀNH PHỐ HỒ CHÍ MINH'
            };
            return fullNames[school] || school;
        }

        // Hiển thị BẢNG ĐIỂM CHUẨN 2025
        function showCutoff2025() {
            if (!admissionProcessed) {
                alert('⚠️ Bạn cần xét tuyển trước để xem điểm chuẩn 2025!');
                return;
            }
            
            const modal = document.getElementById('cutoff2025Modal');
            const tableBody = document.getElementById('cutoff2025TableBody');
            
            let html = '';
            allMajors.sort((a,b) => b.cutoff2024 - a.cutoff2024).forEach((major, index) => {
                const cutoffKey = major.school + '_' + major.code;
                const cutoff2025Value = cutoff2025Generated[cutoffKey];
                const change = cutoff2025Value - major.cutoff2024;
                const changeText = change >= 0 ? `+${change.toFixed(2)}` : `${change.toFixed(2)}`;
                const changeColor = change === 0 ? '#666' : (change >= 0 ? '#d9534f' : '#5cb85c');
                const changeIcon = change === 0 ? '➖' : (change >= 0 ? '📈' : '📉');
                
                html += `
                    <tr>
                        <td data-label="STT">${index + 1}</td>
                        <td data-label="Trường" style="font-weight: bold;">${major.school}</td>
                        <td data-label="Mã ngành">${major.code}</td>
                        <td data-label="Tên ngành">${major.name}</td>
                        <td data-label="ĐC 2024">${major.cutoff2024.toFixed(2)}</td>
                        <td data-label="ĐC 2025" style="font-weight: bold; color: #337ab7;">${cutoff2025Value.toFixed(2)}</td>
                        <td data-label="So sánh" style="color: ${changeColor}; font-weight: bold;">
                            ${changeIcon} ${changeText}
                            ${major.school === 'FPT' ? '<br><small>(Không random)</small>' : ''}
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
            modal.style.display = 'block';
        }
        
        // Hiển thị TỶ LỆ RANDOM
        function showRandomRates() {
            if (!admissionProcessed) {
                alert('⚠️ Bạn cần xét tuyển trước để xem tỷ lệ random!');
                return;
            }
            
            const modal = document.getElementById('randomRatesModal');
            modal.style.display = 'block';
        }

        // Cập nhật dropdown ngành cho tỷ lệ random
        function updateRandomMajorSelect() {
            const schoolSelect = document.getElementById('randomSchoolSelect');
            const majorSelect = document.getElementById('randomMajorSelect');
            
            majorSelect.innerHTML = '<option value="">-- Chọn ngành --</option>';
            
            if (schoolSelect.value) {
                majorSelect.disabled = false;
                const schoolMajors = allMajors.filter(m => m.school === schoolSelect.value && m.probabilities !== null);
                schoolMajors.forEach(major => {
                    const option = document.createElement('option');
                    option.value = major.school + '_' + major.code;
                    option.textContent = `${major.name} (${major.code})`;
                    majorSelect.appendChild(option);
                });
                
                if (schoolMajors.length === 0) {
                    const option = document.createElement('option');
                    option.value = '';
                    option.textContent = '-- FPT không có random --';
                    majorSelect.appendChild(option);
                }
            } else {
                majorSelect.disabled = true;
            }
        }

        // Hiển thị tỷ lệ random của ngành
        function showMajorRandomRate() {
            const schoolSelect = document.getElementById('randomSchoolSelect');
            const majorSelect = document.getElementById('randomMajorSelect');
            const display = document.getElementById('randomRateDisplay');
            
            if (!schoolSelect.value || !majorSelect.value) {
                if (schoolSelect.value === 'FPT') {
                    display.innerHTML = `
                        <div style="background: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 5px; padding: 15px; text-align: center;">
                            <h5 style="color: #337ab7; margin-bottom: 10px;">🏫 ĐẠI HỌC FPT TPHCM</h5>
                            <div style="background: #d1ecf1; padding: 10px; border-radius: 3px; margin: 10px 0;">
                                <strong>📊 CHÍNH SÁCH ĐIỂM CHUẨN ĐẶC BIỆT:</strong>
                            </div>
                            <p style="margin: 8px 0;"><strong>🎯 Điểm chuẩn 2024:</strong> 21.00 điểm (tất cả ngành)</p>
                            <p style="margin: 8px 0;"><strong>🎯 Điểm chuẩn 2025:</strong> 21.00 điểm (giữ nguyên)</p>
                            <div style="background: #dff0d8; padding: 10px; border-radius: 3px; margin: 10px 0;">
                                <strong>✅ FPT KHÔNG RANDOM - GIỮ NGUYÊN ĐIỂM CHUẨN</strong><br>
                                <small>Trường FPT cam kết ổn định điểm chuẩn để tạo điều kiện cho thí sinh</small>
                            </div>
                        </div>
                    `;
                } else {
                    alert('⚠️ Vui lòng chọn trường và ngành!');
                }
                return;
            }
            
            const [school, code] = majorSelect.value.split('_');
            const major = allMajors.find(m => m.school === school && m.code === code);
            
            if (major && major.probabilities) {
                const prob = major.probabilities;
                const cutoffKey = major.school + '_' + major.code;
                const actualCutoff2025 = cutoff2025Generated[cutoffKey];
                const change = actualCutoff2025 - major.cutoff2024;
                
                let html = `
                    <div style="background: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 5px; padding: 15px;">
                        <h5 style="color: #337ab7; margin-bottom: 10px;">📊 ${major.name} (${major.code})</h5>
                        <p style="margin-bottom: 8px;"><strong>🏫 Trường:</strong> ${major.school}</p>
                        <p style="margin-bottom: 8px;"><strong>📈 Điểm chuẩn 2024:</strong> ${major.cutoff2024.toFixed(2)}</p>
                        <p style="margin-bottom: 8px;"><strong>🎯 Điểm chuẩn 2025:</strong> ${actualCutoff2025.toFixed(2)} 
                            <span style="color: ${change >= 0 ? '#d9534f' : '#5cb85c'}; font-weight: bold;">
                                (${change >= 0 ? '+' : ''}${change.toFixed(2)})
                            </span>
                        </p>
                        
                        <h6 style="margin: 15px 0 10px 0; color: #666;">🎲 TỶ LỆ RANDOM CỦA CHÚNG TÔI:</h6>
                        <table class="data-table" style="font-size: 9px;">
                            <thead>
                                <tr>
                                    <th>Khoảng thay đổi</th>
                                    <th>Tỷ lệ (%)</th>
                                    <th>Trạng thái</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ${prob.decrease_over_025 > 0 ? 'style="background: #f2dede;"' : ''}>
                                    <td data-label="Khoảng thay đổi">Giảm > 0.25 điểm</td>
                                    <td data-label="Tỷ lệ (%)" style="font-weight: bold;">${prob.decrease_over_025}%</td>
                                    <td data-label="Trạng thái">${prob.decrease_over_025 > 0 ? '🔴 Có thể' : '⚫ Không'}</td>
                                </tr>
                                <tr ${prob.decrease_0_025 > 0 ? 'style="background: #fcf8e3;"' : ''}>
                                    <td data-label="Khoảng thay đổi">Giảm 0-0.25 điểm</td>
                                    <td data-label="Tỷ lệ (%)" style="font-weight: bold;">${prob.decrease_0_025}%</td>
                                    <td data-label="Trạng thái">${prob.decrease_0_025 > 0 ? '🟡 Có thể' : '⚫ Không'}</td>
                                </tr>
                                <tr ${prob.increase_0_025 > 0 ? 'style="background: #d1ecf1;"' : ''}>
                                    <td data-label="Khoảng thay đổi">Tăng 0-0.25 điểm</td>
                                    <td data-label="Tỷ lệ (%)" style="font-weight: bold;">${prob.increase_0_025}%</td>
                                    <td data-label="Trạng thái">${prob.increase_0_025 > 0 ? '🔵 Có thể' : '⚫ Không'}</td>
                                </tr>
                                <tr ${prob.increase_025_05 > 0 ? 'style="background: #d1ecf1;"' : ''}>
                                    <td data-label="Khoảng thay đổi">Tăng 0.25-0.5 điểm</td>
                                    <td data-label="Tỷ lệ (%)" style="font-weight: bold;">${prob.increase_025_05}%</td>
                                    <td data-label="Trạng thái">${prob.increase_025_05 > 0 ? '🔵 Có thể' : '⚫ Không'}</td>
                                </tr>
                                <tr ${prob.increase_05_075 > 0 ? 'style="background: #d4edda;"' : ''}>
                                    <td data-label="Khoảng thay đổi">Tăng 0.5-0.75 điểm</td>
                                    <td data-label="Tỷ lệ (%)" style="font-weight: bold;">${prob.increase_05_075}%</td>
                                    <td data-label="Trạng thái">${prob.increase_05_075 > 0 ? '🟢 Có thể' : '⚫ Không'}</td>
                                </tr>
                                <tr ${prob.increase_075_1 > 0 ? 'style="background: #d4edda;"' : ''}>
                                    <td data-label="Khoảng thay đổi">Tăng 0.75-1.0 điểm</td>
                                    <td data-label="Tỷ lệ (%)" style="font-weight: bold;">${prob.increase_075_1}%</td>
                                    <td data-label="Trạng thái">${prob.increase_075_1 > 0 ? '🟢 Có thể' : '⚫ Không'}</td>
                                </tr>
                                <tr ${prob.increase_over_1 > 0 ? 'style="background: #f8d7da;"' : ''}>
                                    <td data-label="Khoảng thay đổi">Tăng > 1.0 điểm (tối đa 1.5)</td>
                                    <td data-label="Tỷ lệ (%)" style="font-weight: bold;">${prob.increase_over_1}%</td>
                                    <td data-label="Trạng thái">${prob.increase_over_1 > 0 ? '🔴 Có thể' : '⚫ Không'}</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <div style="margin-top: 10px; padding: 8px; background: #e7f3ff; border-radius: 3px; font-size: 10px;">
                            <strong>💡 Giải thích:</strong> Tỷ lệ dựa trên phân tích xu hướng tuyển sinh 2025[24][27][47].
                        </div>
                    </div>
                `;
                
                display.innerHTML = html;
            }
        }

        // Confetti animation
        function createConfetti() {
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7', '#dda0dd', '#ff9ff3', '#54a0ff'];
            
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.style.position = 'fixed';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.top = '-10px';
                    confetti.style.width = Math.random() * 8 + 5 + 'px';
                    confetti.style.height = Math.random() * 8 + 5 + 'px';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                    confetti.style.pointerEvents = 'none';
                    confetti.style.zIndex = '9999';
                    confetti.style.animation = `fall ${3 + Math.random() * 2}s linear forwards`;
                    
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => {
                        if (confetti.parentNode) {
                            confetti.parentNode.removeChild(confetti);
                        }
                    }, 5000);
                }, i * 20);
            }
        }

        // Utilities
        function getSubjectName(code) {
            const names = {
                'anh': 'Tiếng Anh', 'ly': 'Vật lý', 'hoa': 'Hóa học', 'sinh': 'Sinh học',
                'su': 'Lịch sử', 'dia': 'Địa lý', 'gdkt': 'GDKT & PL', 'tin': 'Tin học', 'congnghe': 'Công nghệ'
            };
            return names[code] || code;
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Dữ liệu mẫu
        function fillSampleData() {
            document.getElementById('toan').value = '8.8';
            document.getElementById('van').value = '8.0';
            document.getElementById('subject1').value = 'ly';
            document.getElementById('score1').disabled = false;
            document.getElementById('score1').value = '9.0';
            document.getElementById('subject2').value = 'anh';
            document.getElementById('score2').disabled = false;
            document.getElementById('score2').value = '9.2';
            
            wishList = [];
            // Dữ liệu mẫu từ file PDF
            const sampleMajors = [
                { school: 'UIT', code: '7480101' },
                { school: 'HCMUS', code: '7480105' }, // Mapping 7480101_TT to existing 7480105
                { school: 'UIT', code: '7480103' },
                { school: 'UIT', code: '7520207' }, // Mapping 752020a1 to existing 7520207
                { school: 'HCMUS', code: 'QHT16' }, // Mapping 75202a1 to Kỹ thuật Điện tử - Viễn thông
                { school: 'HCMUS', code: 'QHT01' }, // Mapping 7440102_NN to new QHT01
                { school: 'UIT', code: '7480106' },
                { school: 'HCMUS', code: 'QHT14' }, // Mapping 7480201_NN to new QHT14
                { school: 'UIT', code: '7480202' },
                { school: 'UIT', code: '7480102' },
                { school: 'UIT', code: '7480104' },
                { school: 'HCMUS', code: 'QHT12' }, // Mapping 7460108_NN to new QHT12
                { school: 'UIT', code: '7460108' }
            ];
            
            sampleMajors.forEach((sample, index) => {
                const major = allMajors.find(m => m.school === sample.school && m.code === sample.code);
                if (major) {
                    wishList.push({
                        ...major, 
                        wishOrder: index + 1
                    });
                } else {
                    console.warn(`Sample major not found: ${sample.school} - ${sample.code}`);
                }
            });
            
            renderWishList();
            updateWishStats();
            updatePaymentInfo();
            checkGeminiButtons();
            showToast('✅ Đã điền dữ liệu mẫu theo hồ sơ UTXT!');
        }

        function resetAll() {
            if (confirm('🔄 Reset tất cả dữ liệu và bắt đầu lại?')) {
                document.getElementById('scoreForm').reset();
                document.getElementById('score1').disabled = true;
                document.getElementById('score2').disabled = true;
                document.getElementById('schoolSelect').value = '';
                document.getElementById('majorSelect').innerHTML = '<option value="">-- Chọn ngành --</option>';
                document.getElementById('majorSelect').disabled = true;
                document.getElementById('areaSelect').value = 'KV2NT';
                
                wishList = [];
                cutoff2025Generated = {};
                admissionProcessed = false;
                paymentCompleted = false;
                
                renderWishList();
                updateWishStats();
                updatePaymentInfo();
                updateAreaInfo();
                checkGeminiButtons();
                
                document.getElementById('paymentSection').style.display = 'none';
                document.getElementById('submitBtn').disabled = true;
                document.getElementById('viewCutoff2025Btn').style.display = 'none';
                document.getElementById('viewRandomRatesBtn').style.display = 'none';
                
                // Reset tên về mặc định
                currentUserName = 'NGUYỄN VĂN A';
                document.getElementById('userName').textContent = currentUserName;
                document.getElementById('userNameInfo').textContent = currentUserName;
                cancelEditName();
                
                // Reset các thông tin cá nhân khác
                document.getElementById('studentId').textContent = '123456';
                document.getElementById('birthPlace').textContent = 'Hà Nội';
                document.getElementById('highSchool').textContent = 'THPT Hogwarts';
                
                showToast('✅ Đã reset hoàn toàn hệ thống!');
            }
        }
        
        // =================================================
        // =========== GEMINI API INTEGRATION ==============
        // =================================================

        const API_KEY = "AIzaSyBKkBFi9YpHb8-xXvSxXTT1Plx8WgHHImM"; // API Key đã được cập nhật
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;

        // Hàm kiểm tra và kích hoạt các nút Gemini
        function checkGeminiButtons() {
            const majorInfoBtn = document.getElementById('geminiMajorInfoBtn');
            const strategyBtn = document.getElementById('geminiStrategyBtn');
            
            // Kích hoạt nút "Tìm hiểu ngành" khi có ngành được chọn
            const majorSelect = document.getElementById('majorSelect');
            if (majorSelect.value) {
                majorInfoBtn.disabled = false;
            } else {
                majorInfoBtn.disabled = true;
            }

            // Kích hoạt nút "Tư vấn" khi có điểm và ít nhất 1 NV
            const scores = getScores();
            const hasAllScores = scores.toan && scores.van && scores[document.getElementById('subject1').value] && scores[document.getElementById('subject2').value];
            if (hasAllScores && wishList.length > 0) {
                strategyBtn.disabled = false;
            } else {
                strategyBtn.disabled = true;
            }
        }

        // Hàm gọi API Gemini với exponential backoff
        async function callGeminiAPI(prompt, maxRetries = 3) {
            let attempt = 0;
            let delay = 1000; // 1 second
            
            while(attempt < maxRetries) {
                try {
                    const payload = {
                        contents: [{
                            parts: [{ text: prompt }]
                        }]
                    };
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        return result.candidates[0].content.parts[0].text;
                    } else {
                        throw new Error("Invalid response structure from Gemini API");
                    }
                } catch (error) {
                    console.error(`Attempt ${attempt + 1} failed:`, error);
                    attempt++;
                    if (attempt < maxRetries) {
                        await new Promise(res => setTimeout(res, delay));
                        delay *= 2; // Double the delay for the next retry
                    } else {
                        return "Rất tiếc, đã có lỗi xảy ra khi kết nối với Trợ lý AI. Vui lòng thử lại sau.";
                    }
                }
            }
        }
        
        // Hiển thị modal loading của Gemini
        function showGeminiLoading(title) {
            const modal = document.getElementById('geminiModal');
            document.getElementById('geminiModalTitle').textContent = title;
            document.getElementById('geminiModalBody').innerHTML = `
                <div class="loading-gemini">
                    <div class="spinner"></div>
                    <p>Trợ lý AI đang phân tích, vui lòng chờ trong giây lát...</p>
                </div>
            `;
            modal.style.display = 'block';
        }

        // Lấy thông tin ngành học
        async function getMajorInfo() {
            const majorSelect = document.getElementById('majorSelect');
            if (!majorSelect.value) return;

            const [school, code] = majorSelect.value.split('_');
            const major = allMajors.find(m => m.school === school && m.code === code);
            if (!major) return;

            const schoolFullName = getSchoolFullName(school).replace(/<br>/g, ' - ');
            showGeminiLoading(`✨ Tìm hiểu về ngành ${major.name}`);

            const prompt = `Hãy cung cấp một bản tóm tắt về ngành '${major.name}' tại trường '${schoolFullName}'. Nội dung bao gồm: các môn học cốt lõi, cơ hội việc làm sau khi ra trường, và những kỹ năng quan trọng cần có cho ngành này. Trình bày dưới dạng các gạch đầu dòng ngắn gọn, dễ hiểu.`;
            
            const responseText = await callGeminiAPI(prompt);
            document.getElementById('geminiModalBody').innerHTML = responseText.replace(/\n/g, '<br>');
        }

        // Lấy tư vấn chiến lược
        async function getStrategicAdvice() {
            if (!validateForm() || wishList.length === 0) {
                alert('⚠️ Vui lòng nhập đủ điểm và thêm ít nhất 1 nguyện vọng để được tư vấn!');
                return;
            }
            
            showGeminiLoading('✨ Chuyên gia AI đang tư vấn chiến lược');

            const scores = getScores();
            let scoresText = `Toán: ${scores.toan}, Ngữ văn: ${scores.van}`;
            const subject1 = document.getElementById('subject1').value;
            const subject2 = document.getElementById('subject2').value;
            scoresText += `, ${getSubjectName(subject1)}: ${scores[subject1]}, ${getSubjectName(subject2)}: ${scores[subject2]}.`;

            const wishListText = wishList.map(w => 
                `NV${w.wishOrder}: Trường ${w.school} - Ngành ${w.name} (Điểm chuẩn 2024: ${w.cutoff2024})`
            ).join('\n');

            const prompt = `Bạn là một chuyên gia tư vấn tuyển sinh đại học giàu kinh nghiệm tại Việt Nam. Dựa vào thông tin điểm thi và danh sách nguyện vọng dưới đây của một học sinh, hãy đưa ra những phân tích và lời khuyên chiến lược. Hãy nhận xét về mức độ 'an toàn', 'phù hợp', và 'tham vọng' của từng nguyện vọng. Đề xuất cách sắp xếp lại nguyện vọng (nếu cần) để tối ưu hóa cơ hội trúng tuyển. Lời khuyên cần cụ thể, mang tính xây dựng và khích lệ.
            ---
            Điểm thi của học sinh: ${scoresText}
            ---
            Danh sách nguyện vọng:
            ${wishListText}
            ---
            Hãy trình bày câu trả lời dưới dạng HTML có cấu trúc rõ ràng, sử dụng thẻ <strong>, <ul>, <li> để dễ đọc.`;

            const responseText = await callGeminiAPI(prompt);
            document.getElementById('geminiModalBody').innerHTML = responseText;
        }
        
        // AI Sắp xếp nguyện vọng
        function populateAiWishSelectors() {
            const selector1 = document.getElementById('aiWish1');
            const selector2 = document.getElementById('aiWish2');
            selector1.innerHTML = '<option value="">-- Chọn nguyện vọng mơ ước 1 --</option>';
            selector2.innerHTML = '<option value="">-- Chọn nguyện vọng mơ ước 2 --</option>';

            allMajors.forEach(major => {
                const option = document.createElement('option');
                option.value = `${major.school}_${major.code}`;
                option.textContent = `${major.school} - ${major.name}`;
                selector1.appendChild(option.cloneNode(true));
                selector2.appendChild(option);
            });
        }

        async function getAiArrangement() {
            const wish1 = document.getElementById('aiWish1').value;
            const wish2 = document.getElementById('aiWish2').value;

            if (!validateForm()) {
                alert('⚠️ Vui lòng nhập đủ điểm thi trước khi nhờ AI sắp xếp!');
                return;
            }
            if (!wish1 || !wish2) {
                alert('⚠️ Vui lòng chọn đủ 2 nguyện vọng mơ ước!');
                return;
            }
            if (wish1 === wish2) {
                alert('⚠️ Vui lòng chọn 2 nguyện vọng khác nhau!');
                return;
            }

            showGeminiLoading('✨ AI đang xây dựng chiến lược cho bạn...');

            const scores = getScores();
            let scoresText = `Toán: ${scores.toan}, Ngữ văn: ${scores.van}`;
            const subject1 = document.getElementById('subject1').value;
            const subject2 = document.getElementById('subject2').value;
            scoresText += `, ${getSubjectName(subject1)}: ${scores[subject1]}, ${getSubjectName(subject2)}: ${scores[subject2]}.`;
            
            const allMajorsText = allMajors.map(m => `${m.school}|${m.code}|${m.name}|${m.cutoff2024}`).join('\n');

            const prompt = `Bạn là một chuyên gia tư vấn tuyển sinh đại học. Dựa vào điểm thi của học sinh, 2 nguyện vọng mơ ước của họ, và danh sách tất cả các ngành có thể chọn, hãy tạo ra một danh sách gồm 8 đến 10 nguyện vọng được sắp xếp theo chiến lược 3 tầng: Mơ ước, Vừa sức, An toàn.
            
            QUY TẮC:
            1.  **Bắt buộc bao gồm** 2 nguyện vọng mơ ước mà học sinh đã chọn ở các vị trí đầu tiên.
            2.  **Chỉ chọn** các ngành từ danh sách được cung cấp.
            3.  **Chiến lược 3 tầng:**
                * **Mơ ước (2-3 NV):** Bao gồm 2 NV học sinh đã chọn và có thể thêm 1 NV khác có điểm chuẩn 2024 cao hơn điểm thi.
                * **Vừa sức (3-4 NV):** Các ngành liên quan có điểm chuẩn 2024 xấp xỉ hoặc thấp hơn một chút so với điểm thi.
                * **An toàn (2-3 NV):** Các ngành có điểm chuẩn 2024 thấp hơn đáng kể so với điểm thi để đảm bảo khả năng trúng tuyển.
            4.  **Định dạng đầu ra:** Chỉ trả về một mảng JSON hợp lệ. Mỗi đối tượng trong mảng phải có hai key là "school" và "code". Ví dụ: [{"school": "UIT", "code": "7480101"}, {"school": "SPKT", "code": "7480201_N"}]. Không thêm bất kỳ văn bản giải thích nào khác.

            ---
            **Thông tin đầu vào:**
            1.  **Điểm thi của học sinh:** ${scoresText}
            2.  **Nguyện vọng mơ ước 1:** ${wish1}
            3.  **Nguyện vọng mơ ước 2:** ${wish2}
            4.  **Danh sách tất cả các ngành (Định dạng: School|Code|Name|Cutoff2024):**
            ${allMajorsText}
            ---
            
            **Yêu cầu đầu ra:** Chỉ trả về mảng JSON.`;

            const responseText = await callGeminiAPI(prompt);
            
            try {
                // Làm sạch output từ AI, chỉ lấy phần JSON
                const jsonMatch = responseText.match(/\[.*\]/s);
                if (!jsonMatch) throw new Error("AI did not return a valid JSON array.");
                
                const newWishListObjects = JSON.parse(jsonMatch[0]);
                
                wishList = []; // Xóa danh sách cũ
                newWishListObjects.forEach((item, index) => {
                    const major = allMajors.find(m => m.school === item.school && m.code === item.code);
                    if (major) {
                        wishList.push({ ...major, wishOrder: index + 1 });
                    }
                });

                renderWishList();
                updateWishStats();
                updatePaymentInfo();
                checkGeminiButtons();
                closeModal('geminiModal');
                showToast('✅ AI đã sắp xếp xong danh sách nguyện vọng cho bạn!');

            } catch (error) {
                console.error("Error parsing AI response:", error);
                document.getElementById('geminiModalBody').innerHTML = `<p style="color: red;">Rất tiếc, AI đã trả về kết quả không hợp lệ. Vui lòng thử lại.</p><p style="font-size: 10px; color: #666;">Lỗi: ${error.message}</p>`;
            }
        }


        // Đóng modal khi click bên ngoài
        window.onclick = function(event) {
            const modals = ['resultModal', 'cutoff2024Modal', 'cutoff2025Modal', 'randomRatesModal', 'guideModal', 'geminiModal'];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                if (!document.getElementById('submitBtn').disabled) {
                    processAdmissionComplete();
                }
            }
            if (e.key === 'Escape') {
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    if (modal.style.display === 'block') {
                        modal.style.display = 'none';
                    }
                });
            }
            if (e.key === 'F1') {
                e.preventDefault();
                showGuide();
            }
            if (e.key === 'F2') {
                e.preventDefault();
                editName();
            }
        });

        // CSS animation cho confetti
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fall {
                to {
                    transform: translateY(100vh) rotate(360deg);
                }
            }
        `;
        document.head.appendChild(style);

        // Thông báo khi tải trang
        window.addEventListener('load', function() {
            setTimeout(() => {
                console.log('🎓 Hệ thống xét tuyển ĐH 2025 đã tải hoàn tất!');
                console.log('✨ ' + allMajors.length + ' ngành từ 4 trường: UIT (' + uitMajors.length + '), HCMUS (' + hcmusMajors.length + '), SPKT (' + spktMajors.length + '), FPT (' + fptMajors.length + ')');
                console.log('🔧 Hotkeys: Ctrl+Enter (nộp), Esc (đóng modal), F1 (hướng dẫn), F2 (sửa tên)');
                console.log('📊 Với điểm chuẩn 2024 chính xác từ tìm kiếm[24][27][47]');
            }, 1000);
        });

    </script>
</body>
</html>